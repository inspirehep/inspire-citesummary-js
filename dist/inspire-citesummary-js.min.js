/*
 * This file is part of INSPIRE HEP.
 * Copyright (C) 2016 CERN.
 *
 * INSPIRE HEP is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as
 * published by the Free Software Foundation; either version 2 of the
 * License, or (at your option) any later version.
 *
 * INSPIRE HEP is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Invenio; if not, write to the Free Software Foundation, Inc.,
 * 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
 *
 * In applying this license, CERN does not
 * waive the privileges and immunities granted to it by virtue of its status
 * as an Intergovernmental Organization or submit itself to any jurisdiction.
 */!function(t){t.module("citeSummary",["citeSummary.services","citeSummary.directives"])}(angular),function(t){function e(){function t(t,e){return e.template}var e=["$scope","CiteSummaryService",function(t,e){t.vm={},t.vm.loading=!0,t.vm.searchTerm=null,t.vm.showRelated=!1,e.load(t.apiEndpoint).then(function(e){t.vm.data=e,setTimeout(function(){citeSummaryVis.renderSummary(t.vm.data),citeSummaryVis.registerResizeListener(t.vm.data)},0)})}];return{templateUrl:t,restrict:"AE",scope:{apiEndpoint:"@apiEndpoint"},controller:e}}t.module("citeSummary.directives",[]).directive("citeSummary",e)}(angular),function(t){t.module("citeSummary.services",[]).factory("CiteSummaryService",["$http",function(t){return{load:function(e){return t.get(e).then(function(t){return t.data}).catch(function(t){return console.error("cannot fetch content from "+e,t),{}})}}}])}(angular);var citeSummaryVis=function(){function t(){try{setTimeout(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub])},1)}catch(t){console.error("We're unable to run the MathJax formatting. Ensure you have added the library to your page.")}}var e=d3.scale.ordinal().domain(["Not Self","Self"]).range(["#3498db","#e74c3c"]),n=d3.scale.ordinal().domain(["Other","Collaboration Paper"]).range(["#95a5a6","#ecf0f1"]),r="%d %b %Y",i=0,a="#7f8c8d",o="#3498db",u={"hep-th":"Theory-HEP","hep-ex":"Experiment-HEP","nucl-th":"Theory-Nucl","hep-ph":"Phenomenology-HEP","nucl-ex":"Experiment-Nucl","hep-lat":"Lattice","gr-qc":"General Relativity","quant-ph":"Quantum Physics","Nuclear Reactions":"General Physics","double-beta decay":"General Physics",astro:"Astrophysics",math:"Math and Math Physics",cs:"Computing",stat:"Data Analysis and Statistics",cond:"Other",nlin:"Other",Relativistic:"Experiment-HEP",Electroweak:"General Physics",Accelerators:"Accelerators","Field Theory":"Lattice",Cosmology:"Astrophysics","Elementary Particles":"General Physics"},s={book:"Book",bookchapter:"Book Chapter",conferencepaper:"Conference Paper",note:"Note",proceedings:"Proceedings",published:"Published",report:"Report",review:"Review",thesis:"Thesis","":"None"},c=d3.time.format(r),l=d3.format("s"),d=function(t){return new Date(t.substring(0,4),t.substring(5,7),t.substring(8))},f=function(t,e){return"string"==typeof t?(t=d3.time.format(r).parse(t),e=d3.time.format(r).parse(e),e-t):e.citation_date-t.citation_date},g=function(){return $(window).width()},h=function(t,e){return 900>=t?.83*t:t*e},p=function(e,n,r,i,a,o){var u=dc.rowChart(e).dimension(n).height(360).width(a).group(r).elasticX(!0).colors(i).valueAccessor(o);u.xAxis().ticks(5),u.xAxis().tickFormat(l),u.ordering(function(t){return-t.value}),u.on("filtered",t)},m=function(e,n,r,i,a){var o=dc.pieChart(e).width(a).dimension(n).radius(60).cx(80).cy(60).innerRadius(40).group(r).colors(i).legend(dc.legend2().x(170).y(0).itemHeight(12).gap(5).horizontal(1).legendWidth(90).itemWidth(95).showPercent(!0));o.ordering(function(t){return-t.value}),o.on("filtered",t)},v=function(t,e){return e.paper_id in t.observedPapers?t.observedPapers[e.paper_id]++:(t.observedPapers[e.paper_id]=1,t.paperCount++),t},x=function(t,e){return t.observedPapers[e.paper_id]--,0===t.observedPapers[e.paper_id]&&(delete t.observedPapers[e.paper_id],t.paperCount--),t},y=function(){return{paperCount:0,observedPapers:{}}},A=function(t){var e=b(t);return e.forEach(function(t,e){t.index=e,t.paper_date=d(t.paper_date),t.citation_date=d(t.citation_date),["paper","citation"].forEach(function(e){var n=t[e+"_subject"];t[e+"_subject"]in u?t[e+"_subject"]=u[n]:Object.keys(u).forEach(function(r){return-1!=n.indexOf(r)?(t[e+"_subject"]=u[r],void 0):void 0});var r=t[e+"_document_type"];t[e+"_document_type"]in s&&(t[e+"_document_type"]=s[r])})}),e},b=function(t){var e=[];return t.forEach(function(t){var n={};Object.keys(t).forEach(function(e){"citations"!==e&&(n["paper_"+e]=t[e])}),n.paper_citation_count=t.citations.length,t.citations.length>0?t.citations.forEach(function(t){var r=$.extend({},n);Object.keys(t).forEach(function(e){"citations"!==e&&(r["citation_"+e]=t[e])}),e.push(r)}):i++}),e};return{registerResizeListener:function(t){function e(){new Date-n<i?setTimeout(e,i):(r=!1,d3.select("#contents").classed("hidden",!0),d3.select("#spinner").classed("hidden",!1),citeSummaryVis.renderSummary(t))}var n,r=!1,i=200;$(window).resize(function(){n=new Date,r===!1&&(r=!0,setTimeout(e,i))})},renderSummary:function(r){var u=!1;r.length>1&&(u=!0);var s=A(r),d=crossfilter(s),b=d.dimension(function(t){return t.citation_date}),_=d.dimension(function(t){return d3.time.year(t.citation_date)}),k=d.dimension(function(t){return t.citation_document_type}),C=d.dimension(function(t){return t.citation_selfcite?"Self":"Not Self"}),D=d.dimension(function(t){return t.citation_collaboration?"Collaboration Paper":"Other"}),E=d.dimension(function(t){return t.citation_subject}),L=d.dimension(function(t){return t.paper_date}),S=d.dimension(function(t){return d3.time.year(t.paper_date)}),w=d.dimension(function(t){return t.paper_document_type}),R=d.dimension(function(t){return t.paper_citation_count}),M=d.dimension(function(t){return t.paper_subject}),B=S.group().reduce(v,x,y),T=R.group().reduce(v,x,y),O=M.group().reduce(v,x,y),F=w.group().reduce(v,x,y),H=_.group(),N=k.group(),P=C.group(),G=E.group(),Y=D.group(),U={all:function(){var t=0,e=[];return H.all().forEach(function(n){t+=n.value,e.push({key:n.key,value:t,single_value:n.value})}),e}},z={all:function(){var t=0,e=[];return B.all().forEach(function(n){t+=n.value.paperCount,e.push({key:n.key,value:t,single_value:n.value.paperCount})}),e}},V=g(),I=d.groupAll();dc.dataCount("#citations_summary").dimension(d).group(I);var j=d.groupAll(),X={};j.reduce(function(t,e){return e.paper_id in X?X[e.paper_id]++:(X[e.paper_id]=1,t++),t},function(t,e){return X[e.paper_id]--,0===X[e.paper_id]&&(delete X[e.paper_id],t--),t},function(){return 0}),dc.dataCount("#papers_summary").dimension(d).group(j).valueAccessor(function(t){return t.value.paperCount});var W={top:20,right:20,bottom:20,left:40};if(u){var q=new Date(L.bottom(1)[0].paper_date),K=new Date(L.top(1)[0].paper_date);q.setDate(q.getDate()-30),K.setDate(K.getDate()+30);var Z=dc.compositeChart(document.getElementById("papers"));Z.width(h(V,u?.47:.85)).height(180).margins(W).dimension(S).x(d3.time.scale().domain([q,K])).xUnits(d3.time.years).xAxisLabel("Publication Year").yAxisLabel("# Papers").elasticY(!0).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).compose([dc.lineChart(Z).dimension(S).group(z,"Cumulative Papers").valueAccessor(function(t){return t.value}).colors(a),dc.barChart(Z).dimension(S).group(z,"Papers").x(d3.time.scale().domain([q,K])).xUnits(d3.time.years).valueAccessor(function(t){return t.single_value}).colors(a)]),Z.yAxis().tickFormat(l),Z.on("filtered",t),Z.legend(dc.legend().x(80).y(20).itemHeight(13).gap(5)).brushOn(!0);var J=h(V,.24),$=function(t){return t.value.paperCount},Q=function(t){return t.value};p("#papers_document_type",w,F,a,J,$),p("#papers_subject_area",M,O,a,J,$);var te=[R.bottom(1)[0].paper_citation_count,R.top(1)[0].paper_citation_count],ee=dc.barChart("#papers_citation_count").width(h(V,.47)).height(150).dimension(R).elasticY(!0).group(T,"Papers").valueAccessor(function(t){return t.value.paperCount}).x(d3.scale.linear().domain([te[0]-1,te[1]+1])).xAxisLabel("# Citations").yAxisLabel("# Papers").colors(a);ee.xAxis().tickFormat(l),ee.on("filtered",t)}var ne=dc.compositeChart(document.getElementById("citations")),re=new Date(b.bottom(1)[0].citation_date),ie=new Date(b.top(1)[0].citation_date);re.setDate(re.getDate()-30),ie.setDate(ie.getDate()+30),ne.width(h(V,u?.42:.85)).height(180).margins(W).x(d3.time.scale().domain([re,ie])).xUnits(d3.time.years).xAxisLabel("Citation Year").yAxisLabel("# Citations").elasticY(!0).renderHorizontalGridLines(!0).dimension(_).renderVerticalGridLines(!0).compose([dc.lineChart(ne).dimension(_).group(U,"Cumulative Citations").valueAccessor(function(t){return t.value}).colors(o),dc.barChart(ne).dimension(_).group(H,"Citations").colors(o)]),ne.yAxis().tickFormat(l),ne.on("filtered",t),ne.legend(dc.legend().x(80).y(20).itemHeight(13).gap(5)).brushOn(!0),p("#citations_subjects",k,N,o,J,Q),p("#citations_subject_area",E,G,o,J,Q),m("#citations_self_cites",C,P,e,J),m("#citations_collaboration",D,Y,n,J);var ae=dc.dataTable("#citations_data_table");ae.dimension(b).group(function(t){return'<div class="dc-title-text"><a href="/record/'+t.paper_id+'">'+t.paper_title+'</a> <div class="dc-published-date label label-default">Published '+c(t.paper_date)+'</div> <p class="text-muted">'+t.paper_citation_count+" citations including:</p> </div>"}).columns([function(){return""},function(t){return'<div class="label label-info cite-info">Cited on '+c(t.citation_date)+"</div>"},function(t){return'<div class="label '+(t.citation_selfcite?"label-danger":"label-default")+'">'+(t.citation_selfcite?" Self Citation":"")+'</div> <a href="/record/'+t.citation_id+'" target="_blank" class="dc-citation-link">'+t.citation_title+"</a>"},function(t){return t.citation_document_type},function(t){return t.citation_subject}]).sortBy(function(t){return t.citation_date}).order(f),ae.on("filtered",t),dc.renderAll(),d3.select("#papers_summary .total-papers").text(r.length),i>0&&(d3.select("#papers_summary .zero-papers").classed("hidden",!1),d3.select("#papers_summary .zero-papers .count").text(i)),d3.select("#spinner").classed("hidden",!0),d3.select("#contents").classed("hidden",!1),setTimeout(function(){t()},0),d3.select("#download_csv").on("click",function(){var t=new Blob([d3.csv.format(L.top(1/0))],{type:"text/csv;charset=utf-8"});saveAs(t,"data.csv")})}}}();!function(){function t(t,e){var n={version:"2.1.0-dev",constants:{CHART_CLASS:"dc-chart",DEBUG_GROUP_CLASS:"debug",STACK_CLASS:"stack",DESELECTED_CLASS:"deselected",SELECTED_CLASS:"selected",NODE_INDEX_NAME:"__index__",GROUP_INDEX_NAME:"__group_index__",DEFAULT_CHART_GROUP:"__default_chart_group__",EVENT_DELAY:40,NEGLIGIBLE_NUMBER:1e-10},_renderlet:null};n.chartRegistry=function(){function t(t){return t||(t=n.constants.DEFAULT_CHART_GROUP),e[t]||(e[t]=[]),t}var e={};return{has:function(t){for(var n in e)if(e[n].indexOf(t)>=0)return!0;return!1},register:function(n,r){r=t(r),e[r].push(n)},deregister:function(n,r){r=t(r);for(var i=0;i<e[r].length;i++)if(e[r][i].anchorName()===n.anchorName()){e[r].splice(i,1);break}},clear:function(t){t?delete e[t]:e={}},list:function(n){return n=t(n),e[n]}}}(),n.registerChart=function(t,e){n.chartRegistry.register(t,e)},n.deregisterChart=function(t,e){n.chartRegistry.deregister(t,e)},n.hasChart=function(t){return n.chartRegistry.has(t)},n.deregisterAllCharts=function(t){n.chartRegistry.clear(t)},n.filterAll=function(t){for(var e=n.chartRegistry.list(t),r=0;r<e.length;++r)e[r].filterAll()},n.refocusAll=function(t){for(var e=n.chartRegistry.list(t),r=0;r<e.length;++r)e[r].focus&&e[r].focus()},n.renderAll=function(t){for(var e=n.chartRegistry.list(t),r=0;r<e.length;++r)e[r].render();null!==n._renderlet&&n._renderlet(t)},n.redrawAll=function(t){for(var e=n.chartRegistry.list(t),r=0;r<e.length;++r)e[r].redraw();null!==n._renderlet&&n._renderlet(t)},n.disableTransitions=!1,n.transition=function(t,e,r,i){if(0>=e||void 0===e||n.disableTransitions)return t;var a=t.transition(i).duration(e);return"function"==typeof r&&r(a),a},n.optionalTransition=function(t,e,r,i){return t?function(t){return n.transition(t,e,r,i)}:function(t){return t}},n.units={},n.units.integers=function(t,e){return Math.abs(e-t)},n.units.ordinal=function(t,e,n){return n},n.units.fp={},n.units.fp.precision=function(t){var e=function(t,r){var i=Math.abs((r-t)/e.resolution);return n.utils.isNegligible(i-Math.floor(i))?Math.floor(i):Math.ceil(i)};return e.resolution=t,e},n.round={},n.round.floor=function(t){return Math.floor(t)},n.round.ceil=function(t){return Math.ceil(t)},n.round.round=function(t){return Math.round(t)},n.override=function(t,e,n){var r=t[e];t["_"+e]=r,t[e]=n},n.renderlet=function(t){return arguments.length?(n._renderlet=t,n):n._renderlet},n.instanceOfChart=function(t){return t instanceof Object&&t.__dcFlag__&&!0},n.errors={},n.errors.Exception=function(t){var e=t||"Unexpected internal error";this.message=e,this.toString=function(){return e},this.stack=(new Error).stack},n.errors.Exception.prototype=Object.create(Error.prototype),n.errors.Exception.prototype.constructor=n.errors.Exception,n.errors.InvalidStateException=function(){n.errors.Exception.apply(this,arguments)},n.errors.InvalidStateException.prototype=Object.create(n.errors.Exception.prototype),n.errors.InvalidStateException.prototype.constructor=n.errors.InvalidStateException,n.errors.BadArgumentException=function(){n.errors.Exception.apply(this,arguments)},n.errors.BadArgumentException.prototype=Object.create(n.errors.Exception.prototype),n.errors.BadArgumentException.prototype.constructor=n.errors.BadArgumentException,n.dateFormat=t.time.format("%m/%d/%Y"),n.printers={},n.printers.filters=function(t){for(var e="",r=0;r<t.length;++r)r>0&&(e+=", "),e+=n.printers.filter(t[r]);return e},n.printers.filter=function(t){var e="";return"undefined"!=typeof t&&null!==t&&(t instanceof Array?t.length>=2?e="["+n.utils.printSingleValue(t[0])+" -> "+n.utils.printSingleValue(t[1])+"]":t.length>=1&&(e=n.utils.printSingleValue(t[0])):e=n.utils.printSingleValue(t)),e},n.pluck=function(t,e){return e?function(n,r){return e.call(n,n[t],r)}:function(e){return e[t]}},n.utils={},n.utils.printSingleValue=function(t){var e=""+t;return t instanceof Date?e=n.dateFormat(t):"string"==typeof t?e=t:n.utils.isFloat(t)?e=n.utils.printSingleValue.fformat(t):n.utils.isInteger(t)&&(e=Math.round(t)),e},n.utils.printSingleValue.fformat=t.format(".2f"),n.utils.add=function(t,e){if("string"==typeof e&&(e=e.replace("%","")),t instanceof Date){"string"==typeof e&&(e=+e);var n=new Date;return n.setTime(t.getTime()),n.setDate(t.getDate()+e),n}if("string"==typeof e){var r=+e/100;return t>0?t*(1+r):t*(1-r)}return t+e},n.utils.subtract=function(t,e){if("string"==typeof e&&(e=e.replace("%","")),t instanceof Date){"string"==typeof e&&(e=+e);var n=new Date;return n.setTime(t.getTime()),n.setDate(t.getDate()-e),n}if("string"==typeof e){var r=+e/100;return 0>t?t*(1+r):t*(1-r)}return t-e},n.utils.isNumber=function(t){return t===+t},n.utils.isFloat=function(t){return t===+t&&t!==(0|t)},n.utils.isInteger=function(t){return t===+t&&t===(0|t)},n.utils.isNegligible=function(t){return!n.utils.isNumber(t)||t<n.constants.NEGLIGIBLE_NUMBER&&t>-n.constants.NEGLIGIBLE_NUMBER},n.utils.clamp=function(t,e,n){return e>t?e:t>n?n:t};var r=0;return n.utils.uniqueId=function(){return++r},n.utils.nameToId=function(t){return t.toLowerCase().replace(/[\s]/g,"_").replace(/[\.']/g,"")},n.utils.appendOrSelect=function(t,e,n){n=n||e;var r=t.select(e);return r.empty()&&(r=t.append(n)),r},n.utils.safeNumber=function(t){return n.utils.isNumber(+t)?+t:0},n.logger={},n.logger.enableDebugLog=!1,n.logger.warn=function(t){return console&&(console.warn?console.warn(t):console.log&&console.log(t)),n.logger},n.logger.debug=function(t){return n.logger.enableDebugLog&&console&&(console.debug?console.debug(t):console.log&&console.log(t)),n.logger},n.logger.deprecate=function(t,e){function r(){return i||(n.logger.warn(e),i=!0),t.apply(this,arguments)}var i=!1;return r},n.events={current:null},n.events.trigger=function(t,e){return e?(n.events.current=t,setTimeout(function(){t===n.events.current&&t()},e),void 0):(t(),void 0)},n.filters={},n.filters.RangedFilter=function(t,e){var n=new Array(t,e);return n.isFiltered=function(t){return t>=this[0]&&t<this[1]},n.filterType="RangedFilter",n},n.filters.TwoDimensionalFilter=function(t){if(null===t)return null;var e=t;return e.isFiltered=function(t){return t.length&&t.length===e.length&&t[0]===e[0]&&t[1]===e[1]},e.filterType="TwoDimensionalFilter",e},n.filters.RangedTwoDimensionalFilter=function(t){if(null===t)return null;var e,n=t;return e=n[0]instanceof Array?[[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1])],[Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]]:[[t[0],-1/0],[t[1],1/0]],n.isFiltered=function(t){var n,r;if(t instanceof Array){if(2!==t.length)return!1;n=t[0],r=t[1]}else n=t,r=e[0][1];return n>=e[0][0]&&n<e[1][0]&&r>=e[0][1]&&r<e[1][1]},n.filterType="RangedTwoDimensionalFilter",n},n.baseMixin=function(r){function i(){f&&f.attr("width",r.width()).attr("height",r.height())}function a(){return f=r.root().append("svg"),i(),f}function o(t){if(!r[t]||!r[t]())throw new n.errors.InvalidStateException("Mandatory attribute chart."+t+" is missing on chart[#"+r.anchorName()+"]")}function u(){if(r.dimension()&&r.dimension().filter){var t=H(r.dimension(),F);F=t?t:F}}r.__dcFlag__=n.utils.uniqueId();var s,c,l,d,f,g,h,p,m=200,v=function(t){var e=t&&t.getBoundingClientRect&&t.getBoundingClientRect().width;return e&&e>m?e:m},x=v,y=200,A=function(t){var e=t&&t.getBoundingClientRect&&t.getBoundingClientRect().height;return e&&e>y?e:y},b=A,_=n.pluck("key"),k=n.pluck("value"),C=n.pluck("key"),D=n.pluck("key"),E=!1,L=function(t){return r.keyAccessor()(t)+": "+r.valueAccessor()(t)},S=!0,w=!0,R=750,M=n.printers.filters,B=["dimension","group"],T=n.constants.DEFAULT_CHART_GROUP,O=t.dispatch("preRender","postRender","preRedraw","postRedraw","filtered","zoomed","renderlet","pretransition"),F=[],H=function(t,e){return 0===e.length?t.filter(null):1!==e.length||e[0].isFiltered?1===e.length&&"RangedFilter"===e[0].filterType?t.filterRange(e[0]):t.filterFunction(function(t){for(var n=0;n<e.length;n++){var r=e[n];if(r.isFiltered&&r.isFiltered(t))return!0;if(t>=r&&r>=t)return!0}return!1}):t.filterExact(e[0]),e},N=function(t){return t.all()};r.height=function(e){return arguments.length?(b=t.functor(e||A),r):b(d.node())},r.width=function(e){return arguments.length?(x=t.functor(e||v),r):x(d.node())},r.minWidth=function(t){return arguments.length?(m=t,r):m},r.minHeight=function(t){return arguments.length?(y=t,r):y},r.dimension=function(t){return arguments.length?(s=t,r.expireCache(),r):s},r.data=function(e){return arguments.length?(N=t.functor(e),r.expireCache(),r):N.call(r,c)},r.group=function(t,e){return arguments.length?(c=t,r._groupName=e,r.expireCache(),r):c},r.ordering=function(t){return arguments.length?(D=t,h=e.quicksort.by(D),r.expireCache(),r):D},r._computeOrderedGroups=function(t){var n=t.slice(0);return n.length<=1?n:(h||(h=e.quicksort.by(D)),h(n,0,n.length))},r.filterAll=function(){return r.filter(null)},r.select=function(t){return d.select(t)},r.selectAll=function(t){return d?d.selectAll(t):null},r.anchor=function(e,i){if(!arguments.length)return l;if(n.instanceOfChart(e))l=e.anchor(),d=e.root(),g=!0;else{if(!e)throw new n.errors.BadArgumentException("parent must be defined");l=e.select&&e.classed?e.node():e,d=t.select(l),d.classed(n.constants.CHART_CLASS,!0),n.registerChart(r,i),g=!1}return T=i,r},r.anchorName=function(){var t=r.anchor();return t&&t.id?t.id:t&&t.replace?t.replace("#",""):"dc-chart"+r.chartID()},r.root=function(t){return arguments.length?(d=t,r):d},r.svg=function(t){return arguments.length?(f=t,r):f},r.resetSvg=function(){return r.select("svg").remove(),a()},r.filterPrinter=function(t){return arguments.length?(M=t,r):M},r.controlsUseVisibility=function(t){return arguments.length?(w=t,r):w},r.turnOnControls=function(){if(d){var t=r.controlsUseVisibility()?"visibility":"display";r.selectAll(".reset").style(t,null),r.selectAll(".filter").text(M(r.filters())).style(t,null)}return r},r.turnOffControls=function(){if(d){var t=r.controlsUseVisibility()?"visibility":"display",e=r.controlsUseVisibility()?"hidden":"none";r.selectAll(".reset").style(t,e),r.selectAll(".filter").style(t,e).text(r.filter())}return r},r.transitionDuration=function(t){return arguments.length?(R=t,r):R},r._mandatoryAttributes=function(t){return arguments.length?(B=t,r):B},r.render=function(){O.preRender(r),B&&B.forEach(o);var t=r._doRender();return p&&p.render(),r._activateRenderlets("postRender"),t},r._activateRenderlets=function(t){O.pretransition(r),r.transitionDuration()>0&&f?f.transition().duration(r.transitionDuration()).each("end",function(){O.renderlet(r),t&&O[t](r)}):(O.renderlet(r),t&&O[t](r))},r.redraw=function(){i(),O.preRedraw(r);var t=r._doRedraw();return p&&p.render(),r._activateRenderlets("postRedraw"),t},r.redrawGroup=function(){n.redrawAll(r.chartGroup())},r.renderGroup=function(){n.renderAll(r.chartGroup())},r._invokeFilteredListener=function(t){void 0!==t&&O.filtered(r,t)},r._invokeZoomedListener=function(){O.zoomed(r)};var P=function(t,e){return null===e||"undefined"==typeof e?t.length>0:t.some(function(t){return t>=e&&e>=t})};r.hasFilterHandler=function(t){return arguments.length?(P=t,r):P},r.hasFilter=function(t){return P(F,t)};var G=function(t,e){for(var n=0;n<t.length;n++)if(t[n]<=e&&t[n]>=e){t.splice(n,1);break}return t};r.removeFilterHandler=function(t){return arguments.length?(G=t,r):G};var Y=function(t,e){return t.push(e),t};r.addFilterHandler=function(t){return arguments.length?(Y=t,r):Y};var U=function(){return[]};return r.resetFilterHandler=function(t){return arguments.length?(U=t,r):U},r.replaceFilter=function(t){F=[],r.filter(t)},r.filter=function(t){return arguments.length?(t instanceof Array&&t[0]instanceof Array&&!t.isFiltered?t[0].forEach(function(t){r.hasFilter(t)?G(F,t):Y(F,t)}):null===t?F=U(F):r.hasFilter(t)?G(F,t):Y(F,t),u(),r._invokeFilteredListener(t),null!==d&&r.hasFilter()?r.turnOnControls():r.turnOffControls(),r):F.length>0?F[0]:null},r.filters=function(){return F},r.highlightSelected=function(e){t.select(e).classed(n.constants.SELECTED_CLASS,!0),t.select(e).classed(n.constants.DESELECTED_CLASS,!1)},r.fadeDeselected=function(e){t.select(e).classed(n.constants.SELECTED_CLASS,!1),t.select(e).classed(n.constants.DESELECTED_CLASS,!0)},r.resetHighlight=function(e){t.select(e).classed(n.constants.SELECTED_CLASS,!1),t.select(e).classed(n.constants.DESELECTED_CLASS,!1)},r.onClick=function(t){var e=r.keyAccessor()(t);n.events.trigger(function(){r.filter(e),r.redrawGroup()})},r.filterHandler=function(t){return arguments.length?(H=t,r):H},r._doRender=function(){return r},r._doRedraw=function(){return r},r.legendables=function(){return[]},r.legendHighlight=function(){},r.legendReset=function(){},r.legendToggle=function(){},r.isLegendableHidden=function(){return!1},r.keyAccessor=function(t){return arguments.length?(_=t,r):_},r.valueAccessor=function(t){return arguments.length?(k=t,r):k},r.label=function(t){return arguments.length?(C=t,E=!0,r):C},r.renderLabel=function(t){return arguments.length?(E=t,r):E},r.title=function(t){return arguments.length?(L=t,r):L},r.renderTitle=function(t){return arguments.length?(S=t,r):S},r.renderlet=n.logger.deprecate(function(t){return r.on("renderlet."+n.utils.uniqueId(),t),r},'chart.renderlet has been deprecated.  Please use chart.on("renderlet.<renderletKey>", renderletFunction)'),r.chartGroup=function(t){return arguments.length?(g||n.deregisterChart(r,T),T=t,g||n.registerChart(r,T),r):T},r.expireCache=function(){return r},r.legend=function(t){return arguments.length?(p=t,p.parent(r),r):p},r.chartID=function(){return r.__dcFlag__},r.options=function(t){var e=["anchor","group","xAxisLabel","yAxisLabel","stack","title","point","getColor","overlayGeoJson"];for(var i in t)"function"==typeof r[i]?t[i]instanceof Array&&-1!==e.indexOf(i)?r[i].apply(r,t[i]):r[i].call(r,t[i]):n.logger.debug("Not a valid option setter name: "+i);return r},r.on=function(t,e){return O.on(t,e),r},r},n.marginMixin=function(t){var e={top:10,right:50,bottom:30,left:30};return t.margins=function(n){return arguments.length?(e=n,t):e},t.effectiveWidth=function(){return t.width()-t.margins().left-t.margins().right},t.effectiveHeight=function(){return t.height()-t.margins().top-t.margins().bottom},t},n.colorMixin=function(e){var n=t.scale.category20c(),r=!0,i=function(t){return e.keyAccessor()(t)};return e.colors=function(r){return arguments.length?(n=r instanceof Array?t.scale.quantize().range(r):t.functor(r),e):n},e.ordinalColors=function(n){return e.colors(t.scale.ordinal().range(n))},e.linearColors=function(n){return e.colors(t.scale.linear().range(n).interpolate(t.interpolateHcl))},e.colorAccessor=function(t){return arguments.length?(i=t,r=!1,e):i},e.defaultColorAccessor=function(){return r},e.colorDomain=function(t){return arguments.length?(n.domain(t),e):n.domain()},e.calculateColorDomain=function(){var r=[t.min(e.data(),e.colorAccessor()),t.max(e.data(),e.colorAccessor())];return n.domain(r),e},e.getColor=function(t,e){return n(i.call(this,t,e))},e.colorCalculator=function(t){return arguments.length?(e.getColor=t,e):e.getColor},e},n.coordinateGridMixin=function(e){function r(){W=!0,Z&&(e.x().domain(f(e.x().domain(),D)),B&&e.x().domain(f(e.x().domain(),B.x().domain())));var t=e.x().domain(),r=n.filters.RangedFilter(t[0],t[1]);e.replaceFilter(r),e.rescale(),e.redraw(),B&&!g(e.filter(),B.filter())&&n.events.trigger(function(){B.replaceFilter(r),B.redraw()}),e._invokeZoomedListener(),n.events.trigger(function(){e.redrawGroup()},n.constants.EVENT_DELAY),W=!g(t,D)}function i(t,e){return!t||!e||t.length!==e.length||t.some(function(t,n){return t.toString()!==e[n].toString()})}function a(t,n){e.isOrdinal()?(e.elasticX()||0===C.domain().length)&&C.domain(e._ordinalXDomain()):e.elasticX()&&C.domain([e.xAxisMin(),e.xAxisMax()]);var r=C.domain();(n||i(L,r))&&e.rescale(),L=r,e.isOrdinal()?C.rangeBands([0,e.xAxisLength()],re,e._useOuterPadding()?ne:0):C.range([0,e.xAxisLength()]),O=O.scale(e.x()),o(t)}function o(t){var r=t.selectAll("g."+v);if(X){r.empty()&&(r=t.insert("g",":first-child").attr("class",p+" "+v).attr("transform","translate("+e.margins().left+","+e.margins().top+")"));var i=O.tickValues()?O.tickValues():"function"==typeof C.ticks?C.ticks(O.ticks()[0]):C.domain(),a=r.selectAll("line").data(i),o=a.enter().append("line").attr("x1",function(t){return C(t)}).attr("y1",e._xAxisY()-e.margins().top).attr("x2",function(t){return C(t)}).attr("y2",0).attr("opacity",0);n.transition(o,e.transitionDuration()).attr("opacity",1),n.transition(a,e.transitionDuration()).attr("x1",function(t){return C(t)}).attr("y1",e._xAxisY()-e.margins().top).attr("x2",function(t){return C(t)}).attr("y2",0),a.exit().remove()}else r.selectAll("line").remove()}function u(){return e._xAxisY()-e.margins().top}function s(){return e.anchorName().replace(/[ .#=\[\]]/g,"-")+"-clip"}function c(){var t=n.utils.appendOrSelect(b,"defs"),r=s(),i=n.utils.appendOrSelect(t,"#"+r,"clipPath").attr("id",r),a=2*ee;n.utils.appendOrSelect(i,"rect").attr("width",e.xAxisLength()+a).attr("height",e.yAxisHeight()+a).attr("transform","translate(-"+ee+", -"+ee+")")}function l(t){e.isOrdinal()&&(I=!1),a(e.g(),t),e._prepareYAxis(e.g()),e.plotData(),(e.elasticX()||q||t)&&e.renderXAxis(e.g()),(e.elasticY()||q||t)&&e.renderYAxis(e.g()),t?e.renderBrush(e.g(),!1):e.redrawBrush(e.g(),q),e.fadeDeselectedArea(),q=!1}function d(){te?e._enableMouseZoom():Q&&e._disableMouseZoom()}function f(e,n){var r=[];return r[0]=t.max([e[0],n[0]]),r[1]=t.min([e[1],n[1]]),r}function g(t,e){return t||e?t&&e?0===t.length&&0===e.length?!0:t[0].valueOf()===e[0].valueOf()&&t[1].valueOf()===e[1].valueOf()?!0:!1:!1:!0}function h(t){return t instanceof Array&&t.length>1}var p="grid-line",m="horizontal",v="vertical",x="y-axis-label",y="x-axis-label",A=12;e=n.colorMixin(n.marginMixin(n.baseMixin(e))),e.colors(t.scale.category10()),e._mandatoryAttributes().push("x");var b,_,k,C,D,E,L,S,w,R,M,B,T,O=t.svg.axis().orient("bottom"),F=n.units.integers,H=0,N=!1,P=0,G=t.svg.axis().orient("left"),Y=0,U=!1,z=0,V=t.svg.brush(),I=!0,j=!1,X=!1,W=!1,q=!1,K=[1,1/0],Z=!0,J=t.behavior.zoom().on("zoom",r),$=t.behavior.zoom().on("zoom",null),Q=!1,te=!1,ee=0,ne=.5,re=0,ie=!1;return e.rescale=function(){return M=void 0,q=!0,e},e.rangeChart=function(t){return arguments.length?(B=t,B.focusChart(e),e):B},e.zoomScale=function(t){return arguments.length?(K=t,e):K},e.zoomOutRestrict=function(t){return arguments.length?(K[0]=t?1:0,Z=t,e):Z},e._generateG=function(t){return b=void 0===t?e.svg():t,_=b.append("g"),k=_.append("g").attr("class","chart-body").attr("transform","translate("+e.margins().left+", "+e.margins().top+")").attr("clip-path","url(#"+s()+")"),_},e.g=function(t){return arguments.length?(_=t,e):_},e.mouseZoomable=function(t){return arguments.length?(te=t,e):te},e.chartBodyG=function(t){return arguments.length?(k=t,e):k},e.x=function(t){return arguments.length?(C=t,D=C.domain(),e.rescale(),e):C},e.xOriginalDomain=function(){return D},e.xUnits=function(t){return arguments.length?(F=t,e):F},e.xAxis=function(t){return arguments.length?(O=t,e):O},e.elasticX=function(t){return arguments.length?(N=t,e):N},e.xAxisPadding=function(t){return arguments.length?(H=t,e):H},e.xUnitCount=function(){if(void 0===M){var t=e.xUnits()(e.x().domain()[0],e.x().domain()[1],e.x().domain());M=t instanceof Array?t.length:t}return M},e.useRightYAxis=function(t){return arguments.length?(ie=t,e):ie},e.isOrdinal=function(){return e.xUnits()===n.units.ordinal},e._useOuterPadding=function(){return!0},e._ordinalXDomain=function(){var t=e._computeOrderedGroups(e.data());return t.map(e.keyAccessor())},e.renderXAxis=function(t){var r=t.selectAll("g.x");r.empty()&&(r=t.append("g").attr("class","axis x").attr("transform","translate("+e.margins().left+","+e._xAxisY()+")"));var i=t.selectAll("text."+y);i.empty()&&e.xAxisLabel()&&(i=t.append("text").attr("class",y).attr("transform","translate("+(e.margins().left+e.xAxisLength()/2)+","+(e.height()-P)+")").attr("text-anchor","middle")),e.xAxisLabel()&&i.text()!==e.xAxisLabel()&&i.text(e.xAxisLabel()),n.transition(r,e.transitionDuration()).attr("transform","translate("+e.margins().left+","+e._xAxisY()+")").call(O),n.transition(i,e.transitionDuration()).attr("transform","translate("+(e.margins().left+e.xAxisLength()/2)+","+(e.height()-P)+")")},e._xAxisY=function(){return e.height()-e.margins().bottom},e.xAxisLength=function(){return e.effectiveWidth()},e.xAxisLabel=function(t,n){return arguments.length?(E=t,e.margins().bottom-=P,P=void 0===n?A:n,e.margins().bottom+=P,e):E},e._prepareYAxis=function(n){if(void 0===S||e.elasticY()){void 0===S&&(S=t.scale.linear());var r=e.yAxisMin()||0,i=e.yAxisMax()||0;S.domain([r,i]).rangeRound([e.yAxisHeight(),0])}S.range([e.yAxisHeight(),0]),G=G.scale(S),ie&&G.orient("right"),e._renderHorizontalGridLinesForAxis(n,S,G)},e.renderYAxisLabel=function(t,r,i,a){a=a||z;var o=e.g().selectAll("text."+x+"."+t+"-label"),u=e.margins().top+e.yAxisHeight()/2;o.empty()&&r&&(o=e.g().append("text").attr("transform","translate("+a+","+u+"),rotate("+i+")").attr("class",x+" "+t+"-label").attr("text-anchor","middle").text(r)),r&&o.text()!==r&&o.text(r),n.transition(o,e.transitionDuration()).attr("transform","translate("+a+","+u+"),rotate("+i+")")},e.renderYAxisAt=function(t,r,i){var a=e.g().selectAll("g."+t);a.empty()&&(a=e.g().append("g").attr("class","axis "+t).attr("transform","translate("+i+","+e.margins().top+")")),n.transition(a,e.transitionDuration()).attr("transform","translate("+i+","+e.margins().top+")").call(r)},e.renderYAxis=function(){var t=ie?e.width()-e.margins().right:e._yAxisX();e.renderYAxisAt("y",G,t);var n=ie?e.width()-z:z,r=ie?90:-90;e.renderYAxisLabel("y",e.yAxisLabel(),r,n)},e._renderHorizontalGridLinesForAxis=function(t,r,i){var a=t.selectAll("g."+m);if(j){var o=i.tickValues()?i.tickValues():r.ticks(i.ticks()[0]);a.empty()&&(a=t.insert("g",":first-child").attr("class",p+" "+m).attr("transform","translate("+e.margins().left+","+e.margins().top+")"));var u=a.selectAll("line").data(o),s=u.enter().append("line").attr("x1",1).attr("y1",function(t){return r(t)}).attr("x2",e.xAxisLength()).attr("y2",function(t){return r(t)}).attr("opacity",0);n.transition(s,e.transitionDuration()).attr("opacity",1),n.transition(u,e.transitionDuration()).attr("x1",1).attr("y1",function(t){return r(t)}).attr("x2",e.xAxisLength()).attr("y2",function(t){return r(t)}),u.exit().remove()}else a.selectAll("line").remove()},e._yAxisX=function(){return e.useRightYAxis()?e.width()-e.margins().right:e.margins().left
},e.yAxisLabel=function(t,n){return arguments.length?(w=t,e.margins().left-=z,z=void 0===n?A:n,e.margins().left+=z,e):w},e.y=function(t){return arguments.length?(S=t,e.rescale(),e):S},e.yAxis=function(t){return arguments.length?(G=t,e):G},e.elasticY=function(t){return arguments.length?(U=t,e):U},e.renderHorizontalGridLines=function(t){return arguments.length?(j=t,e):j},e.renderVerticalGridLines=function(t){return arguments.length?(X=t,e):X},e.xAxisMin=function(){var r=t.min(e.data(),function(t){return e.keyAccessor()(t)});return n.utils.subtract(r,H)},e.xAxisMax=function(){var r=t.max(e.data(),function(t){return e.keyAccessor()(t)});return n.utils.add(r,H)},e.yAxisMin=function(){var r=t.min(e.data(),function(t){return e.valueAccessor()(t)});return n.utils.subtract(r,Y)},e.yAxisMax=function(){var r=t.max(e.data(),function(t){return e.valueAccessor()(t)});return n.utils.add(r,Y)},e.yAxisPadding=function(t){return arguments.length?(Y=t,e):Y},e.yAxisHeight=function(){return e.effectiveHeight()},e.round=function(t){return arguments.length?(R=t,e):R},e._rangeBandPadding=function(t){return arguments.length?(re=t,e):re},e._outerRangeBandPadding=function(t){return arguments.length?(ne=t,e):ne},n.override(e,"filter",function(t){return arguments.length?(e._filter(t),t?e.brush().extent(t):e.brush().clear(),e):e._filter()}),e.brush=function(t){return arguments.length?(V=t,e):V},e.renderBrush=function(t){if(I){V.on("brush",e._brushing),V.on("brushstart",e._disableMouseZoom),V.on("brushend",d);var n=t.append("g").attr("class","brush").attr("transform","translate("+e.margins().left+","+e.margins().top+")").call(V.x(e.x()));e.setBrushY(n,!1),e.setHandlePaths(n),e.hasFilter()&&e.redrawBrush(t,!1)}},e.setHandlePaths=function(t){t.selectAll(".resize").append("path").attr("d",e.resizeHandlePath)},e.setBrushY=function(t){t.selectAll(".brush rect").attr("height",u()),t.selectAll(".resize path").attr("d",e.resizeHandlePath)},e.extendBrush=function(){var t=V.extent();return e.round()&&(t[0]=t.map(e.round())[0],t[1]=t.map(e.round())[1],_.select(".brush").call(V.extent(t))),t},e.brushIsEmpty=function(t){return V.empty()||!t||t[1]<=t[0]},e._brushing=function(){var t=e.extendBrush();if(e.redrawBrush(_,!1),e.brushIsEmpty(t))n.events.trigger(function(){e.filter(null),e.redrawGroup()},n.constants.EVENT_DELAY);else{var r=n.filters.RangedFilter(t[0],t[1]);n.events.trigger(function(){e.replaceFilter(r),e.redrawGroup()},n.constants.EVENT_DELAY)}},e.redrawBrush=function(t,r){if(I){e.filter()&&e.brush().empty()&&e.brush().extent(e.filter());var i=n.optionalTransition(r,e.transitionDuration())(t.select("g.brush"));e.setBrushY(i),i.call(e.brush().x(e.x()).extent(e.brush().extent()))}e.fadeDeselectedArea()},e.fadeDeselectedArea=function(){},e.resizeHandlePath=function(t){var e=+("e"===t),n=e?1:-1,r=u()/3;return"M"+.5*n+","+r+"A6,6 0 0 "+e+" "+6.5*n+","+(r+6)+"V"+(2*r-6)+"A6,6 0 0 "+e+" "+.5*n+","+2*r+"ZM"+2.5*n+","+(r+8)+"V"+(2*r-8)+"M"+4.5*n+","+(r+8)+"V"+(2*r-8)},e.clipPadding=function(t){return arguments.length?(ee=t,e):ee},e._preprocessData=function(){},e._doRender=function(){return e.resetSvg(),e._preprocessData(),e._generateG(),c(),l(!0),d(),e},e._doRedraw=function(){return e._preprocessData(),l(!1),c(),e},e._enableMouseZoom=function(){Q=!0,J.x(e.x()).scaleExtent(K).size([e.width(),e.height()]).duration(e.transitionDuration()),e.root().call(J)},e._disableMouseZoom=function(){e.root().call($)},e.focus=function(t){h(t)?e.x().domain(t):e.x().domain(D),J.x(e.x()),r()},e.refocused=function(){return W},e.focusChart=function(t){return arguments.length?(T=t,e.on("filtered",function(t){t.filter()?g(t.filter(),T.filter())||n.events.trigger(function(){T.focus(t.filter())}):n.events.trigger(function(){T.x().domain(T.xOriginalDomain())})}),e):T},e.brushOn=function(t){return arguments.length?(I=t,e):I},e},n.stackMixin=function(e){function r(t,n){var r=t.accessor||e.valueAccessor();return t.name=String(t.name||n),t.values=t.group.all().map(function(n,i){return{x:e.keyAccessor()(n,i),y:t.hidden?null:r(n,i),data:n,layer:t.name,hidden:t.hidden}}),t.values=t.values.filter(i()),t.values}function i(){if(!e.x())return t.functor(!0);var n=e.x().domain();return e.isOrdinal()?function(){return!0}:e.elasticX()?function(){return!0}:function(t){return t.x>=n[0]&&t.x<=n[n.length-1]}}function a(t){var e=c.map(n.pluck("name")).indexOf(t);return c[e]}function o(){var t=e.data().map(function(t){return t.values});return Array.prototype.concat.apply([],t)}function u(t){return!t.hidden}var s=t.layout.stack().values(r),c=[],l={},d=!1;return e.stack=function(t,n,r){if(!arguments.length)return c;arguments.length<=2&&(r=n);var i={group:t};return"string"==typeof n&&(i.name=n),"function"==typeof r&&(i.accessor=r),c.push(i),e},n.override(e,"group",function(t,n,r){return arguments.length?(c=[],l={},e.stack(t,n),r&&e.valueAccessor(r),e._group(t,n)):e._group()}),e.hidableStacks=function(t){return arguments.length?(d=t,e):d},e.hideStack=function(t){var n=a(t);return n&&(n.hidden=!0),e},e.showStack=function(t){var n=a(t);return n&&(n.hidden=!1),e},e.getValueAccessorByIndex=function(t){return c[t].accessor||e.valueAccessor()},e.yAxisMin=function(){var r=t.min(o(),function(t){return t.y+t.y0<t.y0?t.y+t.y0:t.y0});return n.utils.subtract(r,e.yAxisPadding())},e.yAxisMax=function(){var r=t.max(o(),function(t){return t.y+t.y0});return n.utils.add(r,e.yAxisPadding())},e.xAxisMin=function(){var r=t.min(o(),n.pluck("x"));return n.utils.subtract(r,e.xAxisPadding())},e.xAxisMax=function(){var r=t.max(o(),n.pluck("x"));return n.utils.add(r,e.xAxisPadding())},n.override(e,"title",function(t,n){return t?"function"==typeof t?e._title(t):t===e._groupName&&"function"==typeof n?e._title(n):"function"!=typeof n?l[t]||e._title():(l[t]=n,e):e._title()}),e.stackLayout=function(t){return arguments.length?(s=t,e):s},e.data(function(){var t=c.filter(u);return t.length?e.stackLayout()(t):[]}),e._ordinalXDomain=function(){var t=o().map(n.pluck("data")),r=e._computeOrderedGroups(t);return r.map(e.keyAccessor())},e.colorAccessor(function(t){var e=this.layer||this.name||t.name||t.layer;return e}),e.legendables=function(){return c.map(function(t,n){return{chart:e,name:t.name,hidden:t.hidden||!1,color:e.getColor.call(t,t.values,n)}})},e.isLegendableHidden=function(t){var e=a(t.name);return e?e.hidden:!1},e.legendToggle=function(t){d&&(e.isLegendableHidden(t)?e.showStack(t.name):e.hideStack(t.name),e.renderGroup())},e},n.capMixin=function(e){var r=1/0,i="Others",a=function(n){var r=t.sum(n,e.valueAccessor()),a=e.group().all(),o=t.sum(a,e.valueAccessor()),u=n.map(e.keyAccessor()),s=a.map(e.keyAccessor()),c=t.set(u),l=s.filter(function(t){return!c.has(t)});return o>r?n.concat([{others:l,key:i,value:o-r}]):n};return e.cappedKeyAccessor=function(t,n){return t.others?t.key:e.keyAccessor()(t,n)},e.cappedValueAccessor=function(t,n){return t.others?t.value:e.valueAccessor()(t,n)},e.data(function(t){if(1/0===r)return e._computeOrderedGroups(t.all());var n=t.top(r);return n=e._computeOrderedGroups(n),a?a(n):n}),e.cap=function(t){return arguments.length?(r=t,e):r},e.othersLabel=function(t){return arguments.length?(i=t,e):i},e.othersGrouper=function(t){return arguments.length?(a=t,e):a},n.override(e,"onClick",function(t){t.others&&e.filter([t.others]),e._onClick(t)}),e},n.bubbleMixin=function(e){var r=.3,i=10;e.BUBBLE_NODE_CLASS="node",e.BUBBLE_CLASS="bubble",e.MIN_RADIUS=10,e=n.colorMixin(e),e.renderLabel(!0),e.data(function(t){return t.top(1/0)});var a=t.scale.linear().domain([0,100]),o=function(t){return t.r};e.r=function(t){return arguments.length?(a=t,e):a},e.radiusValueAccessor=function(t){return arguments.length?(o=t,e):o},e.rMin=function(){var n=t.min(e.data(),function(t){return e.radiusValueAccessor()(t)});return n},e.rMax=function(){var n=t.max(e.data(),function(t){return e.radiusValueAccessor()(t)});return n},e.bubbleR=function(t){var n=e.radiusValueAccessor()(t),r=e.r()(n);return(isNaN(r)||0>=n)&&(r=0),r};var u=function(t){return e.label()(t)},s=function(t){return e.bubbleR(t)>i?1:0};e._doRenderLabel=function(t){if(e.renderLabel()){var r=t.select("text");r.empty()&&(r=t.append("text").attr("text-anchor","middle").attr("dy",".3em").on("click",e.onClick)),r.attr("opacity",0).text(u),n.transition(r,e.transitionDuration()).attr("opacity",s)}},e.doUpdateLabels=function(t){if(e.renderLabel()){var r=t.selectAll("text").text(u);n.transition(r,e.transitionDuration()).attr("opacity",s)}};var c=function(t){return e.title()(t)};return e._doRenderTitles=function(t){if(e.renderTitle()){var n=t.select("title");n.empty()&&t.append("title").text(c)}},e.doUpdateTitles=function(t){e.renderTitle()&&t.selectAll("title").text(c)},e.minRadius=function(t){return arguments.length?(e.MIN_RADIUS=t,e):e.MIN_RADIUS},e.minRadiusWithLabel=function(t){return arguments.length?(i=t,e):i},e.maxBubbleRelativeSize=function(t){return arguments.length?(r=t,e):r},e.fadeDeselectedArea=function(){e.hasFilter()?e.selectAll("g."+e.BUBBLE_NODE_CLASS).each(function(t){e.isSelectedNode(t)?e.highlightSelected(this):e.fadeDeselected(this)}):e.selectAll("g."+e.BUBBLE_NODE_CLASS).each(function(){e.resetHighlight(this)})},e.isSelectedNode=function(t){return e.hasFilter(t.key)},e.onClick=function(t){var r=t.key;n.events.trigger(function(){e.filter(r),e.redrawGroup()})},e},n.pieChart=function(e,r){function i(){w=R?R:t.min([z.width(),z.height()])/2;var e,r=v(),i=y();if(t.sum(z.data(),z.valueAccessor())?(e=i(z.data()),M.classed(N,!1)):(e=i([{key:P,value:1,others:[P]}]),M.classed(N,!0)),M){var o=M.selectAll("g."+H).data(e);a(o,r,e),d(e,r),p(o),m(),n.transition(M,z.transitionDuration()).attr("transform","translate("+z.cx()+","+z.cy()+")")}}function a(t,e,n){var r=o(t);u(r,e),s(r),l(n,e)}function o(t){var e=t.enter().append("g").attr("class",function(t,e){return H+" _"+e});return e}function u(t,e){var r=t.append("path").attr("fill",C).on("click",D).attr("d",function(t,n){return E(t,n,e)});n.transition(r,z.transitionDuration(),function(t){t.attrTween("d",_)})}function s(t){z.renderTitle()&&t.append("title").text(function(t){return z.title()(t.data)})}function c(t,e){n.transition(t,z.transitionDuration()).attr("transform",function(t){return L(t,e)}).attr("text-anchor","middle").text(function(t){var e=t.data;return!b(e)&&!A(t)||x(t)?z.label()(t.data):""})}function l(t,e){if(z.renderLabel()){var n=M.selectAll("text."+H).data(t);n.exit().remove();var r=n.enter().append("text").attr("class",function(t,e){var n=H+" _"+e;return O&&(n+=" external"),n}).on("click",D);c(r,e)}}function d(t,e){f(t,e),g(t,e),h(t)}function f(t,e){var r=M.selectAll("g."+H).data(t).select("path").attr("d",function(t,n){return E(t,n,e)});n.transition(r,z.transitionDuration(),function(t){t.attrTween("d",_)}).attr("fill",C)}function g(t,e){if(z.renderLabel()){var n=M.selectAll("text."+H).data(t);c(n,e)}}function h(t){z.renderTitle()&&M.selectAll("g."+H).data(t).select("title").text(function(t){return z.title()(t.data)})}function p(t){t.exit().remove()}function m(){z.hasFilter()?z.selectAll("g."+H).each(function(t){x(t)?z.highlightSelected(this):z.fadeDeselected(this)}):z.selectAll("g."+H).each(function(){z.resetHighlight(this)})}function v(){return t.svg.arc().outerRadius(w-Y).innerRadius(G)}function x(t){return z.hasFilter(z.cappedKeyAccessor(t.data))}function y(){return t.layout.pie().sort(null).value(z.cappedValueAccessor)}function A(t){var e=t.endAngle-t.startAngle;return isNaN(e)||U>e}function b(t){return 0===z.cappedValueAccessor(t)}function _(e){e.innerRadius=G;var n=this._current;k(n)&&(n={startAngle:0,endAngle:0});var r=t.interpolate(n,e);return this._current=r(0),function(t){return E(r(t),0,v())}}function k(t){return!t||isNaN(t.startAngle)||isNaN(t.endAngle)}function C(t,e){return z.getColor(t.data,e)}function D(t,e){M.attr("class")!==N&&z.onClick(t.data,e)}function E(t,e,n){var r=n(t,e);return r.indexOf("NaN")>=0&&(r="M0,0"),r}function L(e,n){var r;return r=O?t.svg.arc().outerRadius(w-Y+O).innerRadius(w-Y+O).centroid(e):n.centroid(e),isNaN(r[0])||isNaN(r[1])?"translate(0,0)":"translate("+r+")"}function S(e,n){z.selectAll("g.pie-slice").each(function(r){e.name===r.data.key&&t.select(this).classed("highlight",n)})}var w,R,M,B,T,O,F=.5,H="pie-slice",N="empty-chart",P="empty",G=0,Y=0,U=F,z=n.capMixin(n.colorMixin(n.baseMixin({})));return z.colorAccessor(z.cappedKeyAccessor),z.title(function(t){return z.cappedKeyAccessor(t)+": "+z.cappedValueAccessor(t)}),z.slicesCap=z.cap,z.label(z.cappedKeyAccessor),z.renderLabel(!0),z.transitionDuration(350),z._doRender=function(){return z.resetSvg(),M=z.svg().append("g").attr("transform","translate("+z.cx()+","+z.cy()+")"),i(),z},z.externalRadiusPadding=function(t){return arguments.length?(Y=t,z):Y},z.innerRadius=function(t){return arguments.length?(G=t,z):G},z.radius=function(t){return arguments.length?(R=t,z):R},z.cx=function(t){return arguments.length?(B=t,z):B||z.width()/2},z.cy=function(t){return arguments.length?(T=t,z):T||z.height()/2},z._doRedraw=function(){return i(),z},z.minAngleForLabel=function(t){return arguments.length?(U=t,z):U},z.emptyTitle=function(t){return 0===arguments.length?P:(P=t,z)},z.externalLabels=function(t){return 0===arguments.length?O:(O=t?t:void 0,z)},z.legendables=function(){return z.data().map(function(t,e){var n={name:t.key,data:t.value,others:t.others,chart:z};return n.color=z.getColor(t,e),n})},z.legendHighlight=function(t){S(t,!0)},z.legendReset=function(t){S(t,!1)},z.legendToggle=function(t){z.onClick({key:t.name,others:t.others})},z.anchor(e,r)},n.barChart=function(e,r){function i(t){return n.utils.safeNumber(Math.abs(d.y()(t.y+t.y0)-d.y()(t.y0)))}function a(t,e,r){var a=t.selectAll("rect.bar").data(r.values,n.pluck("x")),o=a.enter().append("rect").attr("class","bar").attr("fill",n.pluck("data",d.getColor)).attr("y",d.yAxisHeight()).attr("height",0);d.renderTitle()&&o.append("title").text(n.pluck("data",d.title(r.name))),d.isOrdinal()&&a.on("click",d.onClick),n.transition(a,d.transitionDuration()).attr("x",function(t){var e=d.x()(t.x);return g&&(e-=s/2),d.isOrdinal()&&void 0!==f&&(e+=f/2),n.utils.safeNumber(e)}).attr("y",function(t){var e=d.y()(t.y+t.y0);return t.y<0&&(e-=i(t)),n.utils.safeNumber(e)}).attr("width",s).attr("height",function(t){return i(t)}).attr("fill",n.pluck("data",d.getColor)).select("title").text(n.pluck("data",d.title(r.name))),n.transition(a.exit(),d.transitionDuration()).attr("height",0).remove()}function o(){if(void 0===s){var t=d.xUnitCount();s=d.isOrdinal()&&void 0===f?Math.floor(d.x().rangeBand()):f?Math.floor((d.xAxisLength()-(t-1)*f)/t):Math.floor(d.xAxisLength()/(1+d.barPadding())/t),(1/0===s||isNaN(s)||c>s)&&(s=c)}}function u(e,n){return function(){var r=t.select(this),i=r.attr("fill")===e;return n?!i:i}}var s,c=1,l=2,d=n.stackMixin(n.coordinateGridMixin({})),f=l,g=!1,h=!1;return n.override(d,"rescale",function(){return d._rescale(),s=void 0,d}),n.override(d,"render",function(){return d.round()&&g&&!h&&n.logger.warn("By default, brush rounding is disabled if bars are centered. See dc.js bar chart API documentation for details."),d._render()}),d.plotData=function(){var e=d.chartBodyG().selectAll("g.stack").data(d.data());o(),e.enter().append("g").attr("class",function(t,e){return"stack _"+e}),e.each(function(e,n){var r=t.select(this);a(r,n,e)})},d.fadeDeselectedArea=function(){var t=d.chartBodyG().selectAll("rect.bar"),e=d.brush().extent();if(d.isOrdinal())d.hasFilter()?(t.classed(n.constants.SELECTED_CLASS,function(t){return d.hasFilter(t.x)}),t.classed(n.constants.DESELECTED_CLASS,function(t){return!d.hasFilter(t.x)})):(t.classed(n.constants.SELECTED_CLASS,!1),t.classed(n.constants.DESELECTED_CLASS,!1));else if(d.brushIsEmpty(e))t.classed(n.constants.DESELECTED_CLASS,!1);else{var r=e[0],i=e[1];t.classed(n.constants.DESELECTED_CLASS,function(t){return t.x<r||t.x>=i})}},d.centerBar=function(t){return arguments.length?(g=t,d):g},n.override(d,"onClick",function(t){d._onClick(t.data)}),d.barPadding=function(t){return arguments.length?(d._rangeBandPadding(t),f=void 0,d):d._rangeBandPadding()},d._useOuterPadding=function(){return void 0===f},d.outerPadding=d._outerRangeBandPadding,d.gap=function(t){return arguments.length?(f=t,d):f},d.extendBrush=function(){var t=d.brush().extent();return!d.round()||g&&!h||(t[0]=t.map(d.round())[0],t[1]=t.map(d.round())[1],d.chartBodyG().select(".brush").call(d.brush().extent(t))),t},d.alwaysUseRounding=function(t){return arguments.length?(h=t,d):h},d.legendHighlight=function(t){d.isLegendableHidden(t)||d.g().selectAll("rect.bar").classed("highlight",u(t.color)).classed("fadeout",u(t.color,!0))},d.legendReset=function(){d.g().selectAll("rect.bar").classed("highlight",!1).classed("fadeout",!1)},n.override(d,"xAxisMax",function(){var t=this._xAxisMax();if("resolution"in d.xUnits()){var e=d.xUnits().resolution;t+=e}return t}),d.anchor(e,r)},n.lineChart=function(e,r){function i(t,e){return D.getColor.call(t,t.values,e)}function a(e,r){var a=t.svg.line().x(function(t){return D.x()(t.x)}).y(function(t){return D.y()(t.y+t.y0)}).interpolate(M).tension(B);v&&a.defined(v);var o=e.append("path").attr("class","line").attr("stroke",i);x&&o.attr("stroke-dasharray",x),n.transition(r.select("path.line"),D.transitionDuration()).attr("stroke",i).attr("d",function(t){return u(a(t.values))})}function o(e,r){if(E){var a=t.svg.area().x(function(t){return D.x()(t.x)}).y(function(t){return D.y()(t.y+t.y0)}).y0(function(t){return D.y()(t.y0)}).interpolate(M).tension(B);v&&a.defined(v),e.append("path").attr("class","area").attr("fill",i).attr("d",function(t){return u(a(t.values))}),n.transition(r.select("path.area"),D.transitionDuration()).attr("fill",i).attr("d",function(t){return u(a(t.values))})}}function u(t){return!t||t.indexOf("NaN")>=0?"M0,0":t}function s(e,r){if(!D.brushOn()&&D.xyTipsOn()){var i=A+"-list",a=e.select("g."+i);a.empty()&&(a=e.append("g").attr("class",i)),r.each(function(e,r){var i=e.values;v&&(i=i.filter(v));var o=a.select("g."+A+"._"+r);o.empty()&&(o=a.append("g").attr("class",A+" _"+r)),c(o);var u=o.selectAll("circle."+b).data(i,n.pluck("x"));u.enter().append("circle").attr("class",b).attr("r",f()).style("fill-opacity",w).style("stroke-opacity",R).on("mousemove",function(){var e=t.select(this);l(e),d(e,o)}).on("mouseout",function(){var e=t.select(this);g(e),h(o)}),u.attr("cx",function(t){return n.utils.safeNumber(D.x()(t.x))}).attr("cy",function(t){return n.utils.safeNumber(D.y()(t.y+t.y0))}).attr("fill",D.getColor).call(p,e),u.exit().remove()})}}function c(t){var e=t.select("path."+_).empty()?t.append("path").attr("class",_):t.select("path."+_);e.style("display","none").attr("stroke-dasharray","5,5");var n=t.select("path."+k).empty()?t.append("path").attr("class",k):t.select("path."+k);n.style("display","none").attr("stroke-dasharray","5,5")}function l(t){return t.style("fill-opacity",.8),t.style("stroke-opacity",.8),t.attr("r",L),t}function d(t,e){var n=t.attr("cx"),r=t.attr("cy"),i=D._yAxisX()-D.margins().left,a="M"+i+" "+r+"L"+n+" "+r,o="M"+n+" "+D.yAxisHeight()+"L"+n+" "+r;e.select("path."+_).style("display","").attr("d",a),e.select("path."+k).style("display","").attr("d",o)}function f(){return S||L}function g(t){t.style("fill-opacity",w).style("stroke-opacity",R).attr("r",f())}function h(t){t.select("path."+_).style("display","none"),t.select("path."+k).style("display","none")}function p(t,e){D.renderTitle()&&(t.selectAll("title").remove(),t.append("title").text(n.pluck("data",D.title(e.name))))}function m(e,n,r){return function(){var i=t.select(this),a=i.attr("stroke")===e&&i.attr("stroke-dasharray")===(n instanceof Array?n.join(","):null)||i.attr("fill")===e;return r?!a:a}}var v,x,y=5,A="dc-tooltip",b="dot",_="yRef",k="xRef",C=1e-6,D=n.stackMixin(n.coordinateGridMixin({})),E=!1,L=y,S=null,w=C,R=C,M="linear",B=.7,T=!0;return D.transitionDuration(500),D._rangeBandPadding(1),D.plotData=function(){var t=D.chartBodyG(),e=t.selectAll("g.stack-list");e.empty()&&(e=t.append("g").attr("class","stack-list"));var n=e.selectAll("g.stack").data(D.data()),r=n.enter().append("g").attr("class",function(t,e){return"stack _"+e});a(r,n),o(r,n),s(t,n)},D.interpolate=function(t){return arguments.length?(M=t,D):M},D.tension=function(t){return arguments.length?(B=t,D):B},D.defined=function(t){return arguments.length?(v=t,D):v},D.dashStyle=function(t){return arguments.length?(x=t,D):x},D.renderArea=function(t){return arguments.length?(E=t,D):E},D.xyTipsOn=function(t){return arguments.length?(T=t,D):T},D.dotRadius=function(t){return arguments.length?(L=t,D):L},D.renderDataPoints=function(t){return arguments.length?(t?(w=t.fillOpacity||.8,R=t.strokeOpacity||.8,S=t.radius||2):(w=C,R=C,S=null),D):{fillOpacity:w,strokeOpacity:R,radius:S}},D.legendHighlight=function(t){D.isLegendableHidden(t)||D.g().selectAll("path.line, path.area").classed("highlight",m(t.color,t.dashstyle)).classed("fadeout",m(t.color,t.dashstyle,!0))},D.legendReset=function(){D.g().selectAll("path.line, path.area").classed("highlight",!1).classed("fadeout",!1)},n.override(D,"legendables",function(){var t=D._legendables();return x?t.map(function(t){return t.dashstyle=x,t}):t}),D.anchor(e,r)},n.dataCount=function(e,r){var i=t.format(",d"),a=n.baseMixin({}),o={some:"",all:""};return a.html=function(t){return arguments.length?(t.all&&(o.all=t.all),t.some&&(o.some=t.some),a):o},a.formatNumber=function(t){return arguments.length?(i=t,a):i},a._doRender=function(){var t=a.dimension().size(),e=a.group().value(),n=i(t),r=i(e);return t===e&&""!==o.all?a.root().html(o.all.replace("%total-count",n).replace("%filter-count",r)):""!==o.some?a.root().html(o.some.replace("%total-count",n).replace("%filter-count",r)):(a.selectAll(".total-count").text(n),a.selectAll(".filter-count").text(r)),a},a._doRedraw=function(){return a._doRender()},a.anchor(e,r)},n.dataTable=function(e,r){function i(){var t=!0;if(h.forEach(function(e){t&="function"==typeof e}),!t){f.selectAll("th").remove();var e=f.root().selectAll("th").data(h),n=e.enter().append("th");n.attr("class",d).html(function(t){return f._doColumnHeaderFormat(t)})}var r=f.root().selectAll("tbody").data(a(),function(t){return f.keyAccessor()(t)}),i=r.enter().append("tbody");return v===!0&&i.append("tr").attr("class",l).append("td").attr("class",u).attr("colspan",h.length).html(function(t){return f.keyAccessor()(t)}),r.exit().remove(),i}function a(){var e;return e=m===t.ascending?f.dimension().bottom(g):f.dimension().top(g),t.nest().key(f.group()).sortKeys(m).entries(e.sort(function(t,e){return m(p(t),p(e))}))}function o(t){var e=t.order().selectAll("tr."+s).data(function(t){return t.values}),n=e.enter().append("tr").attr("class",s);return h.forEach(function(t,e){n.append("td").attr("class",c+" _"+e).html(function(e){return f._doColumnValueFormat(t,e)})}),e.exit().remove(),e}var u="dc-table-label",s="dc-table-row",c="dc-table-column",l="dc-table-group",d="dc-table-head",f=n.baseMixin({}),g=25,h=[],p=function(t){return t},m=t.ascending,v=!0;return f._doRender=function(){return f.selectAll("tbody").remove(),o(i()),f},f._doColumnValueFormat=function(t,e){return"function"==typeof t?t(e):"string"==typeof t?e[t]:t.format(e)},f._doColumnHeaderFormat=function(t){return"function"==typeof t?f._doColumnHeaderFnToString(t):"string"==typeof t?f._doColumnHeaderCapitalize(t):String(t.label)},f._doColumnHeaderCapitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},f._doColumnHeaderFnToString=function(t){var e=String(t),n=e.indexOf("return ");if(n>=0){var r=e.lastIndexOf(";");if(r>=0){e=e.substring(n+7,r);var i=e.indexOf("numberFormat");i>=0&&(e=e.replace("numberFormat",""))}}return e},f._doRedraw=function(){return f._doRender()},f.size=function(t){return arguments.length?(g=t,f):g},f.columns=function(t){return arguments.length?(h=t,f):h},f.sortBy=function(t){return arguments.length?(p=t,f):p},f.order=function(t){return arguments.length?(m=t,f):m},f.showGroups=function(t){return arguments.length?(v=t,f):v},f.anchor(e,r)},n.dataGrid=function(e,r){function i(){var t=f.root().selectAll("div."+d).data(a(),function(t){return f.keyAccessor()(t)}),e=t.enter().append("div").attr("class",d);return x&&e.html(function(t){return x(t)}),t.exit().remove(),e}function a(){var e=f.dimension().top(g);return t.nest().key(f.group()).sortKeys(m).entries(e.sort(function(t,e){return m(p(t),p(e))}).slice(v,u))}function o(t){var e=t.order().selectAll("div."+c).data(function(t){return t.values});return e.enter().append("div").attr("class",c).html(function(t){return h(t)}),e.exit().remove(),e}var u,s="dc-grid-label",c="dc-grid-item",l="dc-grid-group",d="dc-grid-top",f=n.baseMixin({}),g=999,h=function(t){return"you need to provide an html() handling param:  "+JSON.stringify(t)},p=function(t){return t},m=t.ascending,v=0,x=function(t){return"<div class='"+l+"'><h1 class='"+s+"'>"+f.keyAccessor()(t)+"</h1></div>"};return f._doRender=function(){return f.selectAll("div."+d).remove(),o(i()),f},f._doRedraw=function(){return f._doRender()},f.beginSlice=function(t){return arguments.length?(v=t,f):v},f.endSlice=function(t){return arguments.length?(u=t,f):u},f.size=function(t){return arguments.length?(g=t,f):g},f.html=function(t){return arguments.length?(h=t,f):h},f.htmlGroup=function(t){return arguments.length?(x=t,f):x},f.sortBy=function(t){return arguments.length?(p=t,f):p},f.order=function(t){return arguments.length?(m=t,f):m},f.anchor(e,r)},n.bubbleChart=function(t,e){function r(t){var e=t.enter().append("g");e.attr("class",s.BUBBLE_NODE_CLASS).attr("transform",l).append("circle").attr("class",function(t,e){return s.BUBBLE_CLASS+" _"+e}).on("click",s.onClick).attr("fill",s.getColor).attr("r",0),n.transition(t,s.transitionDuration()).selectAll("circle."+s.BUBBLE_CLASS).attr("r",function(t){return s.bubbleR(t)}).attr("opacity",function(t){return s.bubbleR(t)>0?1:0}),s._doRenderLabel(e),s._doRenderTitles(e)}function i(t){n.transition(t,s.transitionDuration()).attr("transform",l).selectAll("circle."+s.BUBBLE_CLASS).attr("fill",s.getColor).attr("r",function(t){return s.bubbleR(t)}).attr("opacity",function(t){return s.bubbleR(t)>0?1:0}),s.doUpdateLabels(t),s.doUpdateTitles(t)}function a(t){t.exit().remove()}function o(t){var e=s.x()(s.keyAccessor()(t));return isNaN(e)&&(e=0),e}function u(t){var e=s.y()(s.valueAccessor()(t));return isNaN(e)&&(e=0),e}var s=n.bubbleMixin(n.coordinateGridMixin({})),c=!1;s.transitionDuration(750);var l=function(t){return"translate("+o(t)+","+u(t)+")"};return s.elasticRadius=function(t){return arguments.length?(c=t,s):c},s.plotData=function(){c&&s.r().domain([s.rMin(),s.rMax()]),s.r().range([s.MIN_RADIUS,s.xAxisLength()*s.maxBubbleRelativeSize()]);var t=s.chartBodyG().selectAll("g."+s.BUBBLE_NODE_CLASS).data(s.data(),function(t){return t.key});r(t),i(t),a(t),s.fadeDeselectedArea()},s.renderBrush=function(){},s.redrawBrush=function(){s.fadeDeselectedArea()},s.anchor(t,e)},n.compositeChart=function(e,r){function i(){(void 0===A.rightY()||A.elasticY())&&(void 0===A.rightY()&&A.rightY(t.scale.linear()),A.rightY().domain([d(),h()]).rangeRound([A.yAxisHeight(),0])),A.rightY().range([A.yAxisHeight(),0]),A.rightYAxis(A.rightYAxis().scale(A.rightY())),A.rightYAxis().orient("right")}function a(){(void 0===A.y()||A.elasticY())&&(void 0===A.y()&&A.y(t.scale.linear()),A.y().domain([l(),g()]).rangeRound([A.yAxisHeight(),0])),A.y().range([A.yAxisHeight(),0]),A.yAxis(A.yAxis().scale(A.y())),A.yAxis().orient("left")}function o(t,e){t._generateG(A.g()),t.g().attr("class",x+" _"+e)}function u(){return b.filter(function(t){return!t.useRightYAxis()})}function s(){return b.filter(function(t){return t.useRightYAxis()})}function c(t){return t.map(function(t){return t.yAxisMin()})}function l(){return t.min(c(u()))}function d(){return t.min(c(s()))}function f(t){return t.map(function(t){return t.yAxisMax()})}function g(){return n.utils.add(t.max(f(u())),A.yAxisPadding())}function h(){return n.utils.add(t.max(f(s())),A.yAxisPadding())}function p(){return b.map(function(t){return t.xAxisMin()})}function m(){return b.map(function(t){return t.xAxisMax()})}var v,x="sub",y=12,A=n.coordinateGridMixin({}),b=[],_={},k=!1,C=!0,D=t.svg.axis(),E=0,L=y,S=!1;return A._mandatoryAttributes([]),A.transitionDuration(500),n.override(A,"_generateG",function(){for(var t=this.__generateG(),e=0;e<b.length;++e){var n=b[e];o(n,e),n.dimension()||n.dimension(A.dimension()),n.group()||n.group(A.group()),n.chartGroup(A.chartGroup()),n.svg(A.svg()),n.xUnits(A.xUnits()),n.transitionDuration(A.transitionDuration()),n.brushOn(A.brushOn()),n.renderTitle(A.renderTitle()),n.elasticX(A.elasticX())}return t}),A._brushing=function(){var t=A.extendBrush(),e=null;A.brushIsEmpty(t)||(e=n.filters.RangedFilter(t[0],t[1])),n.events.trigger(function(){e?A.replaceFilter(e):A.filter(null),A.redrawGroup()},n.constants.EVENT_DELAY)},A._prepareYAxis=function(){0!==u().length&&a(),0!==s().length&&i(),u().length>0&&!S?A._renderHorizontalGridLinesForAxis(A.g(),A.y(),A.yAxis()):s().length>0&&A._renderHorizontalGridLinesForAxis(A.g(),v,D)},A.renderYAxis=function(){0!==u().length&&(A.renderYAxisAt("y",A.yAxis(),A.margins().left),A.renderYAxisLabel("y",A.yAxisLabel(),-90)),0!==s().length&&(A.renderYAxisAt("yr",A.rightYAxis(),A.width()-A.margins().right),A.renderYAxisLabel("yr",A.rightYAxisLabel(),90,A.width()-L))},A.plotData=function(){for(var t=0;t<b.length;++t){var e=b[t];e.g()||o(e,t),k&&e.colors(A.colors()),e.x(A.x()),e.xAxis(A.xAxis()),e.useRightYAxis()?(e.y(A.rightY()),e.yAxis(A.rightYAxis())):(e.y(A.y()),e.yAxis(A.yAxis())),e.plotData(),e._activateRenderlets()}},A.useRightAxisGridLines=function(t){return arguments?(S=t,A):S},A.childOptions=function(t){return arguments.length?(_=t,b.forEach(function(t){t.options(_)}),A):_},A.fadeDeselectedArea=function(){for(var t=0;t<b.length;++t){var e=b[t];e.brush(A.brush()),e.fadeDeselectedArea()}},A.rightYAxisLabel=function(t,e){return arguments.length?(E=t,A.margins().right-=L,L=void 0===e?y:e,A.margins().right+=L,A):E},A.compose=function(t){return b=t,b.forEach(function(t){t.height(A.height()),t.width(A.width()),t.margins(A.margins()),C&&t.title(A.title()),t.options(_)}),A},A.children=function(){return b},A.shareColors=function(t){return arguments.length?(k=t,A):k},A.shareTitle=function(t){return arguments.length?(C=t,A):C},A.rightY=function(t){return arguments.length?(v=t,A.rescale(),A):v},delete A.yAxisMin,delete A.yAxisMax,n.override(A,"xAxisMin",function(){return n.utils.subtract(t.min(p()),A.xAxisPadding())}),n.override(A,"xAxisMax",function(){return n.utils.add(t.max(m()),A.xAxisPadding())}),A.legendables=function(){return b.reduce(function(t,e){return k&&e.colors(A.colors()),t.push.apply(t,e.legendables()),t},[])},A.legendHighlight=function(t){for(var e=0;e<b.length;++e){var n=b[e];n.legendHighlight(t)}},A.legendReset=function(t){for(var e=0;e<b.length;++e){var n=b[e];n.legendReset(t)}},A.legendToggle=function(){console.log("composite should not be getting legendToggle itself")},A.rightYAxis=function(t){return arguments.length?(D=t,A):D},A.anchor(e,r)},n.seriesChart=function(e,r){function i(e,n){return t.ascending(s.keyAccessor()(e),s.keyAccessor()(n))}function a(t){c[t].g()&&c[t].g().remove(),delete c[t]}function o(){Object.keys(c).map(a),c={}}var u,s=n.compositeChart(e,r),c={},l=n.lineChart,d=t.ascending,f=i;return s._mandatoryAttributes().push("seriesAccessor","chart"),s.shareColors(!0),s._preprocessData=function(){var e,n=[],i=t.nest().key(u);d&&i.sortKeys(d),f&&i.sortValues(f);var o=i.entries(s.data()),g=o.map(function(i,a){var o=c[i.key]||l.call(s,s,r,i.key,a);return c[i.key]||(e=!0),c[i.key]=o,n.push(i.key),o.dimension(s.dimension()).group({all:t.functor(i.values)},i.key).keyAccessor(s.keyAccessor()).valueAccessor(s.valueAccessor()).brushOn(s.brushOn())});Object.keys(c).filter(function(t){return-1===n.indexOf(t)}).forEach(function(t){a(t),e=!0}),s._compose(g),e&&s.legend()&&s.legend().render()},s.chart=function(t){return arguments.length?(l=t,o(),s):l},s.seriesAccessor=function(t){return arguments.length?(u=t,o(),s):u},s.seriesSort=function(t){return arguments.length?(d=t,o(),s):d},s.valueSort=function(t){return arguments.length?(f=t,o(),s):f
},s._compose=s.compose,delete s.compose,s},n.geoChoroplethChart=function(e,r){function i(t){var e=a();if(o(t)){var n=u(t);g(n,t,e),h(n,t,e)}}function a(){for(var t={},e=p.data(),n=0;n<e.length;++n)t[p.keyAccessor()(e[n])]=p.valueAccessor()(e[n]);return t}function o(t){return f(t).keyAccessor}function u(t){var e=p.svg().selectAll(s(t)).classed("selected",function(e){return c(t,e)}).classed("deselected",function(e){return l(t,e)}).attr("class",function(e){var r=f(t).name,i=n.utils.nameToId(f(t).keyAccessor(e)),a=r+" "+i;return c(t,e)&&(a+=" selected"),l(t,e)&&(a+=" deselected"),a});return e}function s(t){return"g.layer"+t+" g."+f(t).name}function c(t,e){return p.hasFilter()&&p.hasFilter(d(t,e))}function l(t,e){return p.hasFilter()&&!p.hasFilter(d(t,e))}function d(t,e){return f(t).keyAccessor(e)}function f(t){return x[t]}function g(e,r,i){var a=e.select("path").attr("fill",function(){var e=t.select(this).attr("fill");return e?e:"none"}).on("click",function(t){return p.onClick(t,r)});n.transition(a,p.transitionDuration()).attr("fill",function(t,e){return p.getColor(i[f(r).keyAccessor(t)],e)})}function h(t,e,n){p.renderTitle()&&t.selectAll("title").text(function(t){var r=d(e,t),i=n[r];return p.title()({key:r,value:i})})}var p=n.colorMixin(n.baseMixin({}));p.colorAccessor(function(t){return t||0});var m,v=t.geo.path(),x=[];return p._doRender=function(){p.resetSvg();for(var t=0;t<x.length;++t){var e=p.svg().append("g").attr("class","layer"+t),n=e.selectAll("g."+f(t).name).data(f(t).data).enter().append("g").attr("class",f(t).name);n.append("path").attr("fill","white").attr("d",v),n.append("title"),i(t)}m=!1},p.onClick=function(t,e){var r=f(e).keyAccessor(t);n.events.trigger(function(){p.filter(r),p.redrawGroup()})},p._doRedraw=function(){for(var t=0;t<x.length;++t)i(t),m&&p.svg().selectAll("g."+f(t).name+" path").attr("d",v);m=!1},p.overlayGeoJson=function(t,e,n){for(var r=0;r<x.length;++r)if(x[r].name===e)return x[r].data=t,x[r].keyAccessor=n,p;return x.push({name:e,data:t,keyAccessor:n}),p},p.projection=function(t){return v.projection(t),m=!0,p},p.geoJsons=function(){return x},p.geoPath=function(){return v},p.removeGeoJson=function(t){for(var e=[],n=0;n<x.length;++n){var r=x[n];r.name!==t&&e.push(r)}return x=e,p},p.anchor(e,r)},n.bubbleOverlay=function(e,r){function i(){return c=g.select("g."+l),c.empty()&&(c=g.svg().append("g").attr("class",l)),c}function a(){var t=o();h.forEach(function(e){var r=u(e,t),i=r.select("circle."+f);i.empty()&&(i=r.append("circle").attr("class",f).attr("r",0).attr("fill",g.getColor).on("click",g.onClick)),n.transition(i,g.transitionDuration()).attr("r",function(t){return g.bubbleR(t)}),g._doRenderLabel(r),g._doRenderTitles(r)})}function o(){var t={};return g.data().forEach(function(e){t[g.keyAccessor()(e)]=e}),t}function u(t,e){var r=d+" "+n.utils.nameToId(t.name),i=c.select("g."+n.utils.nameToId(t.name));return i.empty()&&(i=c.append("g").attr("class",r).attr("transform","translate("+t.x+","+t.y+")")),i.datum(e[t.name]),i}function s(){var t=o();h.forEach(function(e){var r=u(e,t),i=r.select("circle."+f);n.transition(i,g.transitionDuration()).attr("r",function(t){return g.bubbleR(t)}).attr("fill",g.getColor),g.doUpdateLabels(r),g.doUpdateTitles(r)})}var c,l="bubble-overlay",d="node",f="bubble",g=n.bubbleMixin(n.baseMixin({})),h=[];return g.transitionDuration(750),g.radiusValueAccessor(function(t){return t.value}),g.point=function(t,e,n){return h.push({name:t,x:e,y:n}),g},g._doRender=function(){return c=i(),g.r().range([g.MIN_RADIUS,g.width()*g.maxBubbleRelativeSize()]),a(),g.fadeDeselectedArea(),g},g._doRedraw=function(){return s(),g.fadeDeselectedArea(),g},g.debug=function(e){if(e){var r=g.select("g."+n.constants.DEBUG_GROUP_CLASS);r.empty()&&(r=g.svg().append("g").attr("class",n.constants.DEBUG_GROUP_CLASS));var i=r.append("text").attr("x",10).attr("y",20);r.append("rect").attr("width",g.width()).attr("height",g.height()).on("mousemove",function(){var e=t.mouse(r.node()),n=e[0]+", "+e[1];i.text(n)})}else g.selectAll(".debug").remove();return g},g.anchor(e,r),g},n.rowChart=function(e,r){function i(){if(!y||A){var e=t.extent(b,B.cappedValueAccessor);e[0]>0&&(e[0]=0),y=t.scale.linear().domain(e).range([0,B.effectiveWidth()])}T.scale(y)}function a(){var t=x.select("g.axis");i(),t.empty()&&(t=x.append("g").attr("class","axis")),t.attr("transform","translate(0, "+B.effectiveHeight()+")"),n.transition(t,B.transitionDuration()).call(T)}function o(){x.selectAll("g.tick").select("line.grid-line").remove(),x.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(){return-B.effectiveHeight()})}function u(){b=B.data(),a(),o();var t=x.selectAll("g."+w).data(b);s(t),c(t),d(t)}function s(t){var e=t.enter().append("g").attr("class",function(t,e){return w+" _"+e});e.append("rect").attr("width",0),g(e),h(t)}function c(t){t.exit().remove()}function l(){var t=y(0);return t===-1/0||t!==t?y(1):t}function d(t){var e,r=b.length;e=S?S:(B.effectiveHeight()-(r+1)*L)/r,C||(k=e/2);var i=t.attr("transform",function(t,n){return"translate(0,"+((n+1)*L+n*e)+")"}).select("rect").attr("height",e).attr("fill",B.getColor).on("click",p).classed("deselected",function(t){return B.hasFilter()?!v(t):!1}).classed("selected",function(t){return B.hasFilter()?v(t):!1});n.transition(i,B.transitionDuration()).attr("width",function(t){return Math.abs(l()-y(B.valueAccessor()(t)))}).attr("transform",m),f(t),h(t)}function f(t){B.renderTitle()&&(t.selectAll("title").remove(),t.append("title").text(B.title()))}function g(t){B.renderLabel()&&t.append("text").on("click",p),B.renderTitleLabel()&&t.append("text").attr("class",R).on("click",p)}function h(t){if(B.renderLabel()){var e=t.select("text").attr("x",_).attr("y",k).attr("dy",D).on("click",p).attr("class",function(t,e){return w+" _"+e}).text(function(t){return B.label()(t)});n.transition(e,B.transitionDuration()).attr("transform",m)}if(B.renderTitleLabel()){var r=t.select("."+R).attr("x",B.effectiveWidth()-E).attr("y",k).attr("text-anchor","end").on("click",p).attr("class",function(t,e){return R+" _"+e}).text(function(t){return B.title()(t)});n.transition(r,B.transitionDuration()).attr("transform",m)}}function p(t){B.onClick(t)}function m(t){var e=y(B.cappedValueAccessor(t)),n=l(),r=e>n?n:e;return"translate("+r+",0)"}function v(t){return B.hasFilter(B.cappedKeyAccessor(t))}var x,y,A,b,_=10,k=15,C=!1,D="0.35em",E=2,L=5,S=!1,w="row",R="titlerow",M=!1,B=n.capMixin(n.marginMixin(n.colorMixin(n.baseMixin({})))),T=t.svg.axis().orient("bottom");return B.rowsCap=B.cap,B._doRender=function(){return B.resetSvg(),x=B.svg().append("g").attr("transform","translate("+B.margins().left+","+B.margins().top+")"),u(),B},B.title(function(t){return B.cappedKeyAccessor(t)+": "+B.cappedValueAccessor(t)}),B.label(B.cappedKeyAccessor),B.x=function(t){return arguments.length?(y=t,B):y},B.renderTitleLabel=function(t){return arguments.length?(M=t,B):M},B._doRedraw=function(){return u(),B},B.xAxis=function(){return T},B.fixedBarHeight=function(t){return arguments.length?(S=t,B):S},B.gap=function(t){return arguments.length?(L=t,B):L},B.elasticX=function(t){return arguments.length?(A=t,B):A},B.labelOffsetX=function(t){return arguments.length?(_=t,B):_},B.labelOffsetY=function(t){return arguments.length?(k=t,C=!0,B):k},B.titleLabelOffsetX=function(t){return arguments.length?(E=t,B):E},B.anchor(e,r)},n.legend=function(){function t(){return c+s}var e,r,i=2,a={},o=0,u=0,s=12,c=5,l=!1,d=560,f=70,g=!1;return a.parent=function(t){return arguments.length?(e=t,a):e},a.render=function(){e.svg().select("g.dc-legend").remove(),r=e.svg().append("g").attr("class","dc-legend").attr("transform","translate("+o+","+u+")");var a=e.legendables(),h=r.selectAll("g.dc-legend-item").data(a).enter().append("g").attr("class","dc-legend-item").on("mouseover",function(t){e.legendHighlight(t)}).on("mouseout",function(t){e.legendReset(t)}).on("click",function(t){t.chart.legendToggle(t)});r.selectAll("g.dc-legend-item").classed("fadeout",function(t){return t.chart.isLegendableHidden(t)}),a.some(n.pluck("dashstyle"))?h.append("line").attr("x1",0).attr("y1",s/2).attr("x2",s).attr("y2",s/2).attr("stroke-width",2).attr("stroke-dasharray",n.pluck("dashstyle")).attr("stroke",n.pluck("color")):h.append("rect").attr("width",s).attr("height",s).attr("fill",function(t){return t?t.color:"blue"}),h.append("text").text(n.pluck("name")).attr("x",s+i).attr("y",function(){return s/2+(this.clientHeight?this.clientHeight:13)/2-2});var p=0,m=0;h.attr("transform",function(e,n){if(l){var r="translate("+p+","+m*t()+")",i=g===!0?this.getBBox().width+c:f;return p+i>=d?(++m,p=0):p+=i,r}return"translate(0,"+n*t()+")"})},a.x=function(t){return arguments.length?(o=t,a):o},a.y=function(t){return arguments.length?(u=t,a):u},a.gap=function(t){return arguments.length?(c=t,a):c},a.itemHeight=function(t){return arguments.length?(s=t,a):s},a.horizontal=function(t){return arguments.length?(l=t,a):l},a.legendWidth=function(t){return arguments.length?(d=t,a):d},a.itemWidth=function(t){return arguments.length?(f=t,a):f},a.autoItemWidth=function(t){return arguments.length?(g=t,a):g},a},n.scatterPlot=function(e,r){function i(e,r){var i=o.selectAll(".chart-body path.symbol").filter(function(){return e(t.select(this))}),a=u.size();u.size(Math.pow(r,2)),n.transition(i,o.transitionDuration()).attr("d",u),u.size(a)}function a(t){var e=o.selectAll(".chart-body path.symbol").each(function(e){this.filtered=t&&t.isFiltered(e.key)});n.transition(e,o.transitionDuration()).attr("d",u)}var o=n.coordinateGridMixin({}),u=t.svg.symbol(),s=function(t){return t.value},c=o.keyAccessor();o.keyAccessor(function(t){return c(t)[0]}),o.valueAccessor(function(t){return c(t)[1]}),o.colorAccessor(function(){return o._groupName});var l=function(t){return"translate("+o.x()(o.keyAccessor()(t))+","+o.y()(o.valueAccessor()(t))+")"},d=3,f=5,g=0;return u.size(function(t){return s(t)?this.filtered?Math.pow(f,2):Math.pow(d,2):g}),n.override(o,"_filter",function(t){return arguments.length?o.__filter(n.filters.RangedTwoDimensionalFilter(t)):o.__filter()}),o.plotData=function(){var t=o.chartBodyG().selectAll("path.symbol").data(o.data());t.enter().append("path").attr("class","symbol").attr("opacity",0).attr("fill",o.getColor).attr("transform",l),n.transition(t,o.transitionDuration()).attr("opacity",function(t){return s(t)?1:0}).attr("fill",o.getColor).attr("transform",l).attr("d",u),n.transition(t.exit(),o.transitionDuration()).attr("opacity",0).remove()},o.existenceAccessor=function(t){return arguments.length?(s=t,this):s},o.symbol=function(t){return arguments.length?(u.type(t),o):u.type()},o.symbolSize=function(t){return arguments.length?(d=t,o):d},o.highlightedSize=function(t){return arguments.length?(f=t,o):f},o.hiddenSize=function(t){return arguments.length?(g=t,o):g},o.legendables=function(){return[{chart:o,name:o._groupName,color:o.getColor()}]},o.legendHighlight=function(e){i(function(t){return t.attr("fill")===e.color},f),o.selectAll(".chart-body path.symbol").filter(function(){return t.select(this).attr("fill")!==e.color}).classed("fadeout",!0)},o.legendReset=function(e){i(function(t){return t.attr("fill")===e.color},d),o.selectAll(".chart-body path.symbol").filter(function(){return t.select(this).attr("fill")!==e.color}).classed("fadeout",!1)},o.setHandlePaths=function(){},o.extendBrush=function(){var t=o.brush().extent();return o.round()&&(t[0]=t[0].map(o.round()),t[1]=t[1].map(o.round()),o.g().select(".brush").call(o.brush().extent(t))),t},o.brushIsEmpty=function(t){return o.brush().empty()||!t||t[0][0]>=t[1][0]||t[0][1]>=t[1][1]},o._brushing=function(){var t=o.extendBrush();if(o.redrawBrush(o.g()),o.brushIsEmpty(t))n.events.trigger(function(){o.filter(null),o.redrawGroup()}),a(!1);else{var e=n.filters.RangedTwoDimensionalFilter(t);n.events.trigger(function(){o.filter(null),o.filter(e),o.redrawGroup()},n.constants.EVENT_DELAY),a(e)}},o.setBrushY=function(t){t.call(o.brush().y(o.y()))},o.anchor(e,r)},n.numberDisplay=function(e,r){var i="number-display",a=t.format(".2s"),o=n.baseMixin({}),u={one:"",some:"",none:""};return o._mandatoryAttributes(["group"]),o.html=function(t){return arguments.length?(t.none?u.none=t.none:t.one?u.none=t.one:t.some&&(u.none=t.some),t.one?u.one=t.one:t.some&&(u.one=t.some),t.some?u.some=t.some:t.one&&(u.some=t.one),o):u},o.value=function(){return o.data()},o.data(function(t){var e=t.value?t.value():t.top(1)[0];return o.valueAccessor()(e)}),o.transitionDuration(250),o._doRender=function(){var e=o.value(),n=o.selectAll("."+i);n.empty()&&(n=n.data([0]).enter().append("span").attr("class",i)),n.transition().duration(o.transitionDuration()).ease("quad-out-in").tween("text",function(){var n=t.interpolateNumber(this.lastValue||0,e);return this.lastValue=e,function(t){var r=null,i=o.formatNumber()(n(t));0===e&&""!==u.none?r=u.none:1===e&&""!==u.one?r=u.one:""!==u.some&&(r=u.some),this.innerHTML=r?r.replace("%number",i):i}})},o._doRedraw=function(){return o._doRender()},o.formatNumber=function(t){return arguments.length?(a=t,o):a},o.anchor(e,r)},n.heatMap=function(e,r){function i(t,e){var r=p.selectAll(".box-group").filter(function(n){return n.key[t]===e}),i=r.filter(function(t){return!p.hasFilter(t.key)});n.events.trigger(function(){i.empty()?r.each(function(t){p.filter(t.key)}):i.each(function(t){p.filter(t.key)}),p.redrawGroup()})}var a,o,u,s=6.75,c=t.ascending,l=t.ascending,d=t.scale.ordinal(),f=t.scale.ordinal(),g=s,h=s,p=n.colorMixin(n.marginMixin(n.baseMixin({})));p._mandatoryAttributes(["group"]),p.title(p.colorAccessor());var m=function(t){return t},v=function(t){return t};p.colsLabel=function(t){return arguments.length?(m=t,p):m},p.rowsLabel=function(t){return arguments.length?(v=t,p):v};var x=function(t){i(0,t)},y=function(t){i(1,t)},A=function(t){var e=t.key;n.events.trigger(function(){p.filter(e),p.redrawGroup()})};return n.override(p,"filter",function(t){return arguments.length?p._filter(n.filters.TwoDimensionalFilter(t)):p._filter()}),p.rows=function(t){return arguments.length?(u=t,p):u},p.rowOrdering=function(t){return arguments.length?(l=t,p):l},p.cols=function(t){return arguments.length?(o=t,p):o},p.colOrdering=function(t){return arguments.length?(c=t,p):c},p._doRender=function(){return p.resetSvg(),a=p.svg().append("g").attr("class","heatmap").attr("transform","translate("+p.margins().left+","+p.margins().top+")"),p._doRedraw()},p._doRedraw=function(){var t=p.data(),e=p.rows()||t.map(p.valueAccessor()),r=p.cols()||t.map(p.keyAccessor());l&&(e=e.sort(l)),c&&(r=r.sort(c)),e=f.domain(e),r=d.domain(r);var i=e.domain().length,o=r.domain().length,u=Math.floor(p.effectiveWidth()/o),s=Math.floor(p.effectiveHeight()/i);r.rangeRoundBands([0,p.effectiveWidth()]),e.rangeRoundBands([p.effectiveHeight(),0]);var m=a.selectAll("g.box-group").data(p.data(),function(t,e){return p.keyAccessor()(t,e)+"\x00"+p.valueAccessor()(t,e)}),v=m.enter().append("g").attr("class","box-group");v.append("rect").attr("class","heat-box").attr("fill","white").on("click",p.boxOnClick()),p.renderTitle()&&(v.append("title"),m.selectAll("title").text(p.title())),n.transition(m.selectAll("rect"),p.transitionDuration()).attr("x",function(t,e){return r(p.keyAccessor()(t,e))}).attr("y",function(t,n){return e(p.valueAccessor()(t,n))}).attr("rx",g).attr("ry",h).attr("fill",p.getColor).attr("width",u).attr("height",s),m.exit().remove();var x=a.selectAll("g.cols");x.empty()&&(x=a.append("g").attr("class","cols axis"));var y=x.selectAll("text").data(r.domain());y.enter().append("text").attr("x",function(t){return r(t)+u/2}).style("text-anchor","middle").attr("y",p.effectiveHeight()).attr("dy",12).on("click",p.xAxisOnClick()).text(p.colsLabel()),n.transition(y,p.transitionDuration()).text(p.colsLabel()).attr("x",function(t){return r(t)+u/2}).attr("y",p.effectiveHeight()),y.exit().remove();var A=a.selectAll("g.rows");A.empty()&&(A=a.append("g").attr("class","rows axis"));var b=A.selectAll("text").data(e.domain());return b.enter().append("text").attr("dy",6).style("text-anchor","end").attr("x",0).attr("dx",-2).on("click",p.yAxisOnClick()).text(p.rowsLabel()),n.transition(b,p.transitionDuration()).text(p.rowsLabel()).attr("y",function(t){return e(t)+s/2}),b.exit().remove(),p.hasFilter()?p.selectAll("g.box-group").each(function(t){p.isSelectedNode(t)?p.highlightSelected(this):p.fadeDeselected(this)}):p.selectAll("g.box-group").each(function(){p.resetHighlight(this)}),p},p.boxOnClick=function(t){return arguments.length?(A=t,p):A},p.xAxisOnClick=function(t){return arguments.length?(x=t,p):x},p.yAxisOnClick=function(t){return arguments.length?(y=t,p):y},p.xBorderRadius=function(t){return arguments.length?(g=t,p):g},p.yBorderRadius=function(t){return arguments.length?(h=t,p):h},p.isSelectedNode=function(t){return p.hasFilter(t.key)},p.anchor(e,r)},function(){function e(t){return[0,t.length-1]}function n(e){return[t.quantile(e,.25),t.quantile(e,.5),t.quantile(e,.75)]}t.box=function(){function r(e){e.each(function(e,n){e=e.map(s).sort(t.ascending);var r=t.select(this),f=e.length,g=e[0],h=e[f-1],p=e.quartiles=l(e),m=c&&c.call(this,e,n),v=m&&m.map(function(t){return e[t]}),x=m?t.range(0,m[0]).concat(t.range(m[1]+1,f)):t.range(f),y=t.scale.linear().domain(u&&u.call(this,e,n)||[g,h]).range([a,0]),A=this.__chart__||t.scale.linear().domain([0,1/0]).range(y.range());this.__chart__=y;var b=r.selectAll("line.center").data(v?[v]:[]);b.enter().insert("line","rect").attr("class","center").attr("x1",i/2).attr("y1",function(t){return A(t[0])}).attr("x2",i/2).attr("y2",function(t){return A(t[1])}).style("opacity",1e-6).transition().duration(o).style("opacity",1).attr("y1",function(t){return y(t[0])}).attr("y2",function(t){return y(t[1])}),b.transition().duration(o).style("opacity",1).attr("y1",function(t){return y(t[0])}).attr("y2",function(t){return y(t[1])}),b.exit().transition().duration(o).style("opacity",1e-6).attr("y1",function(t){return y(t[0])}).attr("y2",function(t){return y(t[1])}).remove();var _=r.selectAll("rect.box").data([p]);_.enter().append("rect").attr("class","box").attr("x",0).attr("y",function(t){return A(t[2])}).attr("width",i).attr("height",function(t){return A(t[0])-A(t[2])}).transition().duration(o).attr("y",function(t){return y(t[2])}).attr("height",function(t){return y(t[0])-y(t[2])}),_.transition().duration(o).attr("y",function(t){return y(t[2])}).attr("height",function(t){return y(t[0])-y(t[2])});var k=r.selectAll("line.median").data([p[1]]);k.enter().append("line").attr("class","median").attr("x1",0).attr("y1",A).attr("x2",i).attr("y2",A).transition().duration(o).attr("y1",y).attr("y2",y),k.transition().duration(o).attr("y1",y).attr("y2",y);var C=r.selectAll("line.whisker").data(v||[]);C.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",A).attr("x2",i).attr("y2",A).style("opacity",1e-6).transition().duration(o).attr("y1",y).attr("y2",y).style("opacity",1),C.transition().duration(o).attr("y1",y).attr("y2",y).style("opacity",1),C.exit().transition().duration(o).attr("y1",y).attr("y2",y).style("opacity",1e-6).remove();var D=r.selectAll("circle.outlier").data(x,Number);D.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",i/2).attr("cy",function(t){return A(e[t])}).style("opacity",1e-6).transition().duration(o).attr("cy",function(t){return y(e[t])}).style("opacity",1),D.transition().duration(o).attr("cy",function(t){return y(e[t])}).style("opacity",1),D.exit().transition().duration(o).attr("cy",function(t){return y(e[t])}).style("opacity",1e-6).remove();var E=d||y.tickFormat(8),L=r.selectAll("text.box").data(p);L.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",function(t,e){return 1&e?6:-6}).attr("x",function(t,e){return 1&e?i:0}).attr("y",A).attr("text-anchor",function(t,e){return 1&e?"start":"end"}).text(E).transition().duration(o).attr("y",y),L.transition().duration(o).text(E).attr("y",y);var S=r.selectAll("text.whisker").data(v||[]);S.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",i).attr("y",A).text(E).style("opacity",1e-6).transition().duration(o).attr("y",y).style("opacity",1),S.transition().duration(o).text(E).attr("y",y).style("opacity",1),S.exit().transition().duration(o).attr("y",y).style("opacity",1e-6).remove()}),t.timer.flush()}var i=1,a=1,o=0,u=null,s=Number,c=e,l=n,d=null;return r.width=function(t){return arguments.length?(i=t,r):i},r.height=function(t){return arguments.length?(a=t,r):a},r.tickFormat=function(t){return arguments.length?(d=t,r):d},r.duration=function(t){return arguments.length?(o=t,r):o},r.domain=function(e){return arguments.length?(u=null===e?e:t.functor(e),r):u},r.value=function(t){return arguments.length?(s=t,r):s},r.whiskers=function(t){return arguments.length?(c=t,r):c},r.quartiles=function(t){return arguments.length?(l=t,r):l},r}}(),n.boxPlot=function(e,r){function i(t){return function(e){var n=e.quartiles[0],r=e.quartiles[2],i=(r-n)*t,a=-1,o=e.length;do++a;while(e[a]<n-i);do--o;while(e[o]>r+i);return[a,o]}}function a(t){var e=t.enter().append("g");e.attr("class","box").attr("transform",p).call(f).on("click",function(t){s.filter(t.key),s.redrawGroup()})}function o(e){n.transition(e,s.transitionDuration()).attr("transform",p).call(f).each(function(){t.select(this).select("rect.box").attr("fill",s.getColor)})}function u(t){t.exit().remove().call(f)}var s=n.coordinateGridMixin({}),c=1.5,l=i,d=l(c),f=t.box(),g=null,h=function(t,e){return s.isOrdinal()?s.x().rangeBand():t/(1+s.boxPadding())/e};s.yAxisPadding(12),s.x(t.scale.ordinal()),s.xUnits(n.units.ordinal),s.data(function(t){return t.all().map(function(t){return t.map=function(e){return e.call(t,t)},t}).filter(function(t){var e=s.valueAccessor()(t);return 0!==e.length})}),s.boxPadding=s._rangeBandPadding,s.boxPadding(.8),s.outerPadding=s._outerRangeBandPadding,s.outerPadding(.5),s.boxWidth=function(e){return arguments.length?(h=t.functor(e),s):h};var p=function(t,e){var n=s.x()(s.keyAccessor()(t,e));return"translate("+n+", 0)"};return s._preprocessData=function(){s.elasticX()&&s.x().domain([])},s.plotData=function(){var t=h(s.effectiveWidth(),s.xUnitCount());f.whiskers(d).width(t).height(s.effectiveHeight()).value(s.valueAccessor()).domain(s.y().domain()).duration(s.transitionDuration()).tickFormat(g);var e=s.chartBodyG().selectAll("g.box").data(s.data(),function(t){return t.key});a(e),o(e),u(e),s.fadeDeselectedArea()},s.fadeDeselectedArea=function(){s.hasFilter()?s.g().selectAll("g.box").each(function(t){s.isSelectedNode(t)?s.highlightSelected(this):s.fadeDeselected(this)}):s.g().selectAll("g.box").each(function(){s.resetHighlight(this)})},s.isSelectedNode=function(t){return s.hasFilter(t.key)},s.yAxisMin=function(){var e=t.min(s.data(),function(e){return t.min(s.valueAccessor()(e))});return n.utils.subtract(e,s.yAxisPadding())},s.yAxisMax=function(){var e=t.max(s.data(),function(e){return t.max(s.valueAccessor()(e))});return n.utils.add(e,s.yAxisPadding())},s.tickFormat=function(t){return arguments.length?(g=t,s):g},s.anchor(e,r)},n.selectMenu=function(e,r){function i(){var t=u.selectAll("option."+c).data(l.data(),function(t){return l.keyAccessor()(t)});return t.enter().append("option").classed(c,!0).attr("value",function(t){return l.keyAccessor()(t)}),t.text(l.title()),t.exit().remove(),u.selectAll("option."+c).sort(h),u.on("change",a),t}function a(){var e,n=t.event.target;if(n.selectedOptions){var r=Array.prototype.slice.call(n.selectedOptions);e=r.map(function(t){return t.value})}else{var i=[].slice.call(t.event.target.options);e=i.filter(function(t){return t.selected}).map(function(t){return t.value})}1===e.length&&""===e[0]?e=null:1===e.length&&(e=e[0]),l.onChange(e)}function o(){f?u.attr("multiple",!0):u.attr("multiple",null),null!==g?u.attr("size",g):u.attr("size",null)}var u,s="dc-select-menu",c="dc-select-option",l=n.baseMixin({}),d="Select all",f=!1,g=null,h=function(t,e){return l.keyAccessor()(t)>l.keyAccessor()(e)?1:l.keyAccessor()(e)>l.keyAccessor()(t)?-1:0},p=function(t){return l.valueAccessor()(t)>0};return l.data(function(t){return t.all().filter(p)}),l._doRender=function(){return l.select("select").remove(),u=l.root().append("select").classed(s,!0),o(),u.append("option").text(d).attr("value",""),i(),l},l._doRedraw=function(){return o(),i(),l.hasFilter()&&f?u.selectAll("option").filter(function(t){return t&&l.filters().indexOf(String(l.keyAccessor()(t)))>=0}).property("selected",!0):l.hasFilter()?u.property("value",l.filter()):u.property("value",""),l},l.onChange=function(t){t&&f?l.replaceFilter([t]):t?l.replaceFilter(t):l.filterAll(),n.events.trigger(function(){l.redrawGroup()})},l.order=function(t){return arguments.length?(h=t,l):h},l.promptText=function(t){return arguments.length?(d=t,l):d},l.filterDisplayed=function(t){return arguments.length?(p=t,l):p},l.multiple=function(t){return arguments.length?(f=t,l):f},l.size=function(t){return arguments.length?(g=t,l):g},l.anchor(e,r)},n.abstractBubbleChart=n.bubbleMixin,n.baseChart=n.baseMixin,n.capped=n.capMixin,n.colorChart=n.colorMixin,n.coordinateGridChart=n.coordinateGridMixin,n.marginable=n.marginMixin,n.stackableChart=n.stackMixin,n.d3=t,n.crossfilter=e,n}if("function"==typeof define&&define.amd)define(["d3","crossfilter"],t);else if("object"==typeof module&&module.exports){var e=require("d3"),n=require("crossfilter");"function"!=typeof n&&(n=n.crossfilter),module.exports=t(e,n)}else this.dc=t(d3,crossfilter)}(),dc.legend2=function(){function t(){return s+u}var e,n,r=2,i={},a=0,o=0,u=12,s=5,c=!1,l=560,d=70,f=!1,g=!1,h=1;return i.parent=function(t){return arguments.length?(e=t,i):e},i.render=function(){e.svg().select("g.dc-legend").remove(),n=e.svg().append("g").attr("class","dc-legend").attr("transform","translate("+a+","+o+")");var i=e.legendables(),p=n.selectAll("g.dc-legend-item").data(i).enter().append("g").attr("class","dc-legend-item").on("mouseover",function(t){e.legendHighlight(t)}).on("mouseout",function(t){e.legendReset(t)}).on("click",function(t){t.chart.legendToggle(t)});n.selectAll("g.dc-legend-item").classed("fadeout",function(t){return t.chart.isLegendableHidden(t)}),p.append("rect").attr("width",u).attr("height",u).attr("fill",function(t){return t?t.color:"blue"}),p.append("text").text(function(t){var e=t.name;if(g){var n=t.chart.group().all().reduce(function(t,e){return t+e.value},0);e=e+" - "+(100*t.data/n).toFixed(h)+"%"}return e}).attr("x",u+r).attr("y",function(){return u/2+(this.clientHeight?this.clientHeight:13)/2-2});var m=0,v=0;p.attr("transform",function(e,n){if(c){var r="translate("+m+","+v*t()+")",i=f===!0?this.getBBox().width+s:d;return m+i>=l?(++v,m=0):m+=i,r}return"translate(0,"+n*t()+")"})},i.x=function(t){return arguments.length?(a=t,i):a},i.y=function(t){return arguments.length?(o=t,i):o},i.gap=function(t){return arguments.length?(s=t,i):s},i.itemHeight=function(t){return arguments.length?(u=t,i):u},i.horizontal=function(t){return arguments.length?(c=t,i):c},i.legendWidth=function(t){return arguments.length?(l=t,i):l},i.itemWidth=function(t){return arguments.length?(d=t,i):d},i.autoItemWidth=function(t){return arguments.length?(f=t,i):f},i.showPercent=function(t){return arguments.length?(g=t,i):g},i.percentDecimals=function(t){return arguments.length?(h=t,i):h},i};